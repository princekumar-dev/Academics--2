System.register(["./index-legacy-539dcb9c.js","./react-vendor-legacy-4587369d.js"],function(e,t){"use strict";var a,r,s,n,l,d;return{setters:[e=>{a=e.a,r=e.j,s=e.b,n=e.S},e=>{l=e.r,d=e.L}],execute:function(){e("default",function(){const[e,t]=l.useState(null),[i,c]=l.useState([]),[o,m]=l.useState(!0);l.useEffect(()=>{const e=localStorage.getItem("auth");if(!e)return;try{const t=JSON.parse(e);if("student"!==t.role)return;h(t,!0),u(t,!0)}catch(r){console.error("Invalid auth data",r)}const t=()=>{try{const e=localStorage.getItem("auth");if(!e)return;const t=JSON.parse(e);if("student"!==t.role)return;u(t,!0)}catch(r){}},a=()=>{try{const e=localStorage.getItem("auth");if(!e)return;const t=JSON.parse(e);if("student"!==t.role)return;h(t,!0),u(t,!0)}catch(r){console.error("authStateChanged handler error",r)}};return window.addEventListener("marksheetsUpdated",t),window.addEventListener("notificationsUpdated",t),window.addEventListener("authStateChanged",a),()=>{window.removeEventListener("marksheetsUpdated",t),window.removeEventListener("notificationsUpdated",t),window.removeEventListener("authStateChanged",a)}},[]);const h=async(e,r=!1)=>{try{const s=encodeURIComponent(e.phoneNumber||e.parentPhoneNumber),n=encodeURIComponent(e.regNumber||""),l=r?{cache:!1,dedupe:!1}:{},d=await a.get(`/api/users?studentPhoneNumber=${s}&regNumber=${n}`,l);if(d.success&&d.user){const a={...e,...d.user,role:"student"};t(a)}else t(e)}catch(s){console.error("Failed to fetch student data:",s),t(e)}},u=async(e,t=!1)=>{m(!0);try{const r=new URLSearchParams;e.id&&r.set("studentId",e.id),e.regNumber&&r.set("regNumber",e.regNumber),e.phoneNumber&&r.set("phoneNumber",e.phoneNumber);const s=t?{cache:!1,dedupe:!1}:{},n=await a.get(`/api/marksheets?${r.toString()}`,s);if(n.success){const e=(n.marksheets||[]).filter(e=>"dispatched"===e.status);c(e)}}catch(r){console.error("Failed to load student marksheets",r)}finally{m(!1)}};return r("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:s("div",{className:"max-w-5xl mx-auto px-4 py-8",children:[r("div",{className:"glass-card p-8 rounded-3xl mb-8 backdrop-blur-lg border border-white/20 shadow-lg",children:s("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[s("div",{children:[r("p",{className:"text-xs font-semibold text-blue-600 uppercase tracking-wider",children:"Student Dashboard"}),r("h1",{className:"text-4xl font-bold text-gray-900 mt-2",children:e?.name}),s("div",{className:"mt-6 space-y-2",children:[s("p",{className:"text-sm text-gray-600",children:["Registration: ",r("span",{className:"font-semibold text-gray-900",children:e?.regNumber})]}),s("p",{className:"text-sm text-gray-600",children:["Department: ",r("span",{className:"font-semibold text-gray-900",children:e?.department||"AI_DS"})]}),s("p",{className:"text-sm text-gray-600",children:["Year: ",r("span",{className:"font-semibold text-gray-900",children:e?.year})," | Section: ",r("span",{className:"font-semibold text-gray-900",children:e?.section})]})]})]}),s("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-6 border border-blue-100",children:[r("p",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Contact Information"}),r("div",{className:"mt-4",children:s("div",{children:[r("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold",children:"Parent's Phone"}),r("p",{className:"text-lg font-bold text-gray-900 mt-1",children:e?.parentPhoneNumber||"N/A"})]})})]})]})}),s("div",{className:"glass-card p-8 rounded-3xl backdrop-blur-lg border border-white/20 shadow-lg",children:[s("div",{className:"flex items-center justify-between mb-8",children:[s("div",{children:[r("h2",{className:"text-2xl font-bold text-gray-900",children:"Your Marksheets"}),r("p",{className:"text-sm text-gray-500 mt-1",children:"Swipe left to download or view"})]}),r(d,{to:"/contact",className:"text-blue-600 text-sm font-semibold hover:text-blue-700 transition-colors",children:"Need help?"})]}),o?r("div",{className:"flex items-center justify-center py-12",children:s("div",{className:"text-center",children:[r("div",{className:"inline-block w-8 h-8 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"}),r("p",{className:"text-gray-600 mt-3",children:"Loading your marksheets..."})]})}):0===i.length?s("div",{className:"text-center py-16",children:[r("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:r("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"})})}),r("p",{className:"text-gray-600 font-medium",children:"No marksheets yet"}),r("p",{className:"text-gray-500 text-sm mt-1",children:"Your marksheets will appear here once they are dispatched"})]}):r("div",{className:"space-y-4",children:i.map(e=>r(n,{actions:[{label:"Download",icon:"ðŸ“¥",onClick:()=>{window.open(`/api/generate-pdf?marksheetId=${e._id}`,"_blank")},className:"bg-blue-600"}],children:s("div",{className:"bg-white",children:[s("div",{className:"p-6",children:[s("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 mb-4",children:[s("div",{className:"flex-1 min-w-0",children:[r("h3",{className:"text-lg sm:text-xl font-bold text-gray-900 mb-1 break-words",children:e.studentDetails?.examinationName||"Examination"}),s("p",{className:"text-xs sm:text-sm text-gray-600",children:[e.studentDetails?.regNumber," â€¢ ",e.studentDetails?.year,"-",e.studentDetails?.section]})]}),s("span",{className:"px-2 py-0.5 sm:px-3 sm:py-1 rounded-full text-xs font-semibold uppercase tracking-wide flex items-center gap-0.5 sm:gap-1 flex-shrink-0 whitespace-nowrap "+("dispatched"===e.status?"bg-purple-100 text-purple-700":"approved_by_hod"===e.status?"bg-blue-100 text-blue-700":"dispatch_requested"===e.status?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"),children:["ðŸ“¤ ",(e.status||"unknown").replace(/_/g," ")]})]}),s("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 sm:gap-6 text-xs sm:text-sm",children:[s("div",{children:[r("p",{className:"text-gray-500 mb-1 font-medium",children:"Department"}),r("p",{className:"font-medium text-gray-900",children:e.studentDetails?.department||"â€”"})]}),s("div",{children:[r("p",{className:"text-gray-500 mb-1 font-medium",children:"Result"}),r("p",{className:"font-bold "+("Pass"===e.overallResult?"text-green-600":"Fail"===e.overallResult?"text-red-600":"text-gray-600"),children:e.overallResult||"â€”"})]}),s("div",{children:[r("p",{className:"text-gray-500 mb-1 font-medium",children:"Updated"}),r("p",{className:"font-medium text-gray-900",children:e.updatedAt?new Date(e.updatedAt).toLocaleDateString("en-IN"):"â€”"})]}),s("div",{children:[r("p",{className:"text-gray-500 mb-1 font-medium",children:"Parent Phone"}),r("p",{className:"font-medium text-gray-900 truncate",children:e.studentDetails?.parentPhoneNumber||"â€”"})]})]}),r("div",{className:"hidden sm:flex gap-3 mt-4 justify-end",children:s("a",{href:`/api/generate-pdf?marksheetId=${e._id}`,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-100 text-blue-700 rounded-lg font-semibold text-sm hover:bg-blue-200 transition-colors",children:[r("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download PDF"]})})]}),r("div",{className:"sm:hidden p-3 bg-gradient-to-r from-blue-50 to-indigo-50 border-t border-blue-100",children:s("p",{className:"text-xs text-center text-gray-600 flex items-center justify-center gap-2",children:[r("span",{children:"ðŸ‘ˆ"}),r("span",{className:"font-medium",children:"Swipe left to download"})]})})]})},e._id))})]})]})})})}}});
