import{a as v,b as s,j as t,F as T}from"./index-ba65f9b1.js";import{u as W,r as i}from"./react-vendor-ad4d5528.js";import{d as z}from"./resultUtils-190b400a.js";function K(){const f=W(),[n]=i.useState(()=>{const e=localStorage.getItem("auth");return e?JSON.parse(e):null}),[d,y]=i.useState([]),[L,N]=i.useState(!0),[g,w]=i.useState("ALL"),[x,S]=i.useState("all"),[D,A]=i.useState(new Set),[p,k]=i.useState("");i.useEffect(()=>{if((n==null?void 0:n.role)==="staff"||(n==null?void 0:n.role)==="hod"){C();const e=()=>C(!0);return window.addEventListener("marksheetsUpdated",e),window.addEventListener("notificationsUpdated",e),()=>{window.removeEventListener("marksheetsUpdated",e),window.removeEventListener("notificationsUpdated",e)}}else N(!1)},[n]);const C=async(e=!1)=>{if(n){N(!0);try{let a;const r=new URLSearchParams(window.location.search),l=r.get("year"),m=r.get("includeAll")==="true",o=r.get("department"),c=e?{cache:!1,dedupe:!1}:{};if(n.role==="hod"&&n.department==="HNS"&&!l&&!o)a=await v.get("/api/marksheets?year=I&includeAll=true",c);else if(n.role==="staff"){const P=(n==null?void 0:n._id)||(n==null?void 0:n.id)||localStorage.getItem("userId");a=await v.get("/api/marksheets?staffId=".concat(P,"&includeAll=true"),c)}else n.role==="hod"&&(l&&m?a=await v.get("/api/marksheets?year=".concat(encodeURIComponent(l),"&includeAll=true"),c):o?a=await v.get("/api/marksheets?department=".concat(encodeURIComponent(o),"&includeAll=true"),c):a=await v.get("/api/marksheets?department=".concat(encodeURIComponent(n.department),"&includeAll=true"),c));let u;a&&typeof a.json=="function"?u=await a.json():u=a,u&&u.success?y(u.marksheets||[]):Array.isArray(u)?y(u):y([])}catch(a){console.error("Error fetching marksheets:",a),y([])}finally{N(!1)}}},h=i.useMemo(()=>{const e={};return d.forEach(a=>{var l;const r=a.examinationName||((l=a.studentDetails)==null?void 0:l.examinationName)||"Unknown Examination";e[r]||(e[r]=[]),e[r].push(a)}),Object.keys(e).forEach(a=>{e[a].sort((r,l)=>{var c,u;const m=(((c=r.studentDetails)==null?void 0:c.regNumber)||"").toString().toLowerCase(),o=(((u=l.studentDetails)==null?void 0:u.regNumber)||"").toString().toLowerCase();return m.localeCompare(o,void 0,{numeric:!0,sensitivity:"base"})})}),e},[d]),j=i.useMemo(()=>{const e={};return Object.keys(h).forEach(a=>{const r=h[a];e[a]={total:r.length,draft:r.filter(l=>l.status==="draft").length,verified:r.filter(l=>l.status==="verified_by_staff").length,requested:r.filter(l=>l.status==="dispatch_requested").length,approved:r.filter(l=>l.status==="approved_by_hod").length,dispatched:r.filter(l=>l.status==="dispatched").length,rejected:r.filter(l=>l.status==="rejected_by_hod").length}}),e},[h]),M=i.useMemo(()=>Object.keys(h).length,[h]),b=i.useMemo(()=>{let e=[];if(x==="all"?e=[...d]:e=h[x]||[],(n==null?void 0:n.role)==="hod"&&(n==null?void 0:n.department)==="HNS"&&g&&g!=="ALL"){const a=g.toString().trim().toUpperCase();e=e.filter(r=>{var l;return(((l=r.studentDetails)==null?void 0:l.department)||"").toString().trim().toUpperCase()===a})}if(p.trim()){const a=p.toLowerCase().trim();e=e.filter(r=>{var o,c;const l=(((o=r.studentDetails)==null?void 0:o.name)||"").toLowerCase(),m=(((c=r.studentDetails)==null?void 0:c.regNumber)||"").toLowerCase();return l.includes(a)||m.includes(a)})}return e.sort((a,r)=>{var o,c;const l=(((o=a.studentDetails)==null?void 0:o.regNumber)||"").toString().toLowerCase(),m=(((c=r.studentDetails)==null?void 0:c.regNumber)||"").toString().toLowerCase();return l.localeCompare(m,void 0,{numeric:!0,sensitivity:"base"})})},[d,x,h,p,g,n]),_=i.useMemo(()=>{const e=new Set;return d.forEach(a=>{var m;const r=(m=a.studentDetails)==null?void 0:m.department;if(!r)return;const l=r.toString().trim().toUpperCase();l&&e.add(l)}),Array.from(e).sort()},[d]),E=e=>{A(a=>{const r=new Set(a);return r.has(e)?r.delete(e):r.add(e),r})},U=i.useCallback(e=>w(e),[]),$=i.useCallback(e=>S(e),[]),R=i.useCallback(e=>E(e),[E]),O=i.useCallback(e=>f("/marksheets/".concat(e)),[f]),I=i.memo(({d:e,count:a,active:r,onSelect:l})=>s("button",{onClick:()=>l(e),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat(r?"bg-yellow-600 text-white":"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"),children:[e," (",a,")"]})),F=i.memo(({examName:e,count:a,active:r,onSelect:l})=>s("button",{onClick:()=>l(e),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat(r?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"),children:[e," (",a,")"]})),V=i.memo(({marksheet:e,onView:a})=>{var r,l,m,o;return t("div",{className:"glass-card rounded-xl overflow-hidden",children:s("div",{className:"p-6",children:[t("div",{className:"flex items-start justify-between mb-3",children:s("div",{children:[t("h3",{className:"text-xl font-bold text-gray-900 mb-1",children:(r=e.studentDetails)==null?void 0:r.name}),s("p",{className:"text-sm text-gray-600",children:[(l=e.studentDetails)==null?void 0:l.regNumber," • ",Q(e.studentDetails)]})]})}),s("div",{className:"flex flex-col md:grid md:grid-cols-2 lg:grid-cols-5 gap-4 md:gap-6",children:[s("div",{children:[t("p",{className:"text-gray-500 mb-1 text-xs md:text-sm",children:"Examination:"}),t("p",{className:"font-medium text-gray-900 text-sm md:text-base",children:e.examinationName||((m=e.studentDetails)==null?void 0:m.examinationName)||"—"})]}),s("div",{children:[t("p",{className:"text-gray-500 mb-1 text-xs md:text-sm",children:"Exam Date:"}),t("p",{className:"font-medium text-gray-900 text-sm md:text-base",children:e.examinationDate?new Date(e.examinationDate).toLocaleDateString("en-US",{month:"short",year:"numeric"}):(o=e.studentDetails)!=null&&o.examinationDate?new Date(e.studentDetails.examinationDate).toLocaleDateString("en-US",{month:"short",year:"numeric"}):"—"})]}),s("div",{children:[t("p",{className:"text-gray-500 mb-1 text-xs md:text-sm",children:"Overall Result:"}),t("p",{className:"font-medium text-gray-900 text-sm md:text-base",children:z(e)})]}),s("div",{children:[t("p",{className:"text-gray-500 mb-1 text-xs md:text-sm",children:"Created:"}),t("p",{className:"font-medium text-gray-900 text-sm md:text-base",children:new Date(e.createdAt).toLocaleDateString()})]}),t("div",{className:"flex items-end md:justify-end",children:t("button",{onClick:()=>a(e._id),className:"w-full md:w-auto px-4 py-2 rounded-lg font-medium text-blue-600 border border-blue-200 bg-white hover:bg-blue-50 text-center text-sm transition-all duration-200 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1",children:"View Details"})})]})]})},e._id)});if(!n||n.role!=="staff"&&n.role!=="hod")return t("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 flex items-center justify-center",children:s("div",{className:"glass-card p-8 rounded-3xl text-center",children:[t("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Access Denied"}),t("p",{className:"text-gray-600",children:"Only staff members and HODs can access records."})]})});const q=d.length,B=d.filter(e=>e.status==="verified_by_staff"||e.status==="dispatch_requested"||e.status==="approved_by_hod"||e.status==="dispatched").length;d.filter(e=>e.status==="dispatch_requested").length;const H=d.filter(e=>e.status==="dispatched").length;return t("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 no-mobile-anim",children:t("div",{className:"responsive-container py-6 md:py-8",children:s("div",{className:"max-w-7xl mx-auto",children:[t("div",{className:"mb-6 md:mb-8",children:t("div",{className:"glass-card no-mobile-backdrop responsive-spacing rounded-3xl",children:s("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[s("div",{children:[t("h1",{className:"text-3xl sm:text-4xl lg:text-5xl font-black text-[#111418] mb-2",children:"Marksheet Records"}),s("p",{className:"text-base sm:text-lg text-gray-600",children:["View and manage all marksheet records for ",n.department," Department"]})]}),s("div",{className:"grid grid-cols-2 sm:flex sm:flex-wrap gap-2 sm:gap-3",children:[s("div",{className:"glass-card px-3 py-2 rounded-xl text-center sm:text-left",children:[t("div",{className:"text-xs text-gray-500 whitespace-nowrap",children:"Total Exams"}),t("div",{className:"text-lg sm:text-xl md:text-2xl font-bold text-theme-gold-600",children:M})]}),s("div",{className:"glass-card px-3 py-2 rounded-xl text-center sm:text-left",children:[t("div",{className:"text-xs text-gray-500 whitespace-nowrap",children:"Total Records"}),t("div",{className:"text-lg sm:text-xl md:text-2xl font-bold text-blue-600",children:q})]}),s("div",{className:"glass-card px-3 py-2 rounded-xl text-center sm:text-left",children:[t("div",{className:"text-xs text-gray-500",children:"Verified"}),t("div",{className:"text-lg sm:text-xl md:text-2xl font-bold text-green-600",children:B})]}),s("div",{className:"glass-card px-3 py-2 rounded-xl text-center sm:text-left",children:[t("div",{className:"text-xs text-gray-500",children:"Dispatched"}),t("div",{className:"text-lg sm:text-xl md:text-2xl font-bold text-purple-600",children:H})]})]})]})})}),t("div",{className:"glass-card p-4 sm:p-6 md:p-8 rounded-2xl md:rounded-3xl mb-8",children:L?s("div",{className:"text-center py-12",children:[t("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),t("p",{className:"text-gray-600",children:"Loading marksheet records..."})]}):d.length===0?s("div",{className:"text-center py-12",children:[t("svg",{className:"w-16 h-16 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),t("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Records Found"}),t("p",{className:"text-gray-600",children:"Start by importing marks to create your first marksheet records."})]}):s(T,{children:[s("div",{className:"mb-8",children:[s("div",{className:"relative max-w-2xl",children:[t("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:t("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),t("input",{type:"text",placeholder:"Search name or register no...",value:p,onChange:e=>k(e.target.value),className:"w-full pl-12 pr-12 py-3.5 rounded-xl border border-gray-200 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm md:text-base transition-shadow shadow-sm hover:shadow-md placeholder:text-sm md:placeholder:text-base"}),p&&t("button",{onClick:()=>k(""),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Clear search",children:t("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),p&&t("p",{className:"mt-3 text-sm text-gray-600 font-medium",children:b.length>0?"Found ".concat(b.length," result").concat(b.length!==1?"s":""):"No results found"})]}),(n==null?void 0:n.role)==="hod"&&(n==null?void 0:n.department)==="HNS"&&s("div",{className:"mb-6",children:[t("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Filter by Department"}),s("div",{className:"flex flex-wrap gap-2",children:[s("button",{onClick:()=>w("ALL"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat(g==="ALL"?"bg-yellow-600 text-white":"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"),children:["All Departments (",d.length,")"]}),_.map(e=>t(I,{d:e,count:d.filter(a=>{var r;return(((r=a.studentDetails)==null?void 0:r.department)||"").toString().trim().toUpperCase()===e}).length,active:g===e,onSelect:U},e))]})]}),s("div",{className:"mb-8",children:[t("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Filter by Examination"}),s("div",{className:"flex flex-wrap gap-2",children:[s("button",{onClick:()=>S("all"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors ".concat(x==="all"?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"),children:["All Examinations (",d.length,")"]}),Object.keys(h).sort().map(e=>t(F,{examName:e,count:h[e].length,active:x===e,onSelect:$},e))]})]}),x==="all"&&s("div",{className:"mb-8",children:[t("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Examination Overview"}),t("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.keys(h).sort().map(e=>{const a=j[e],r=D.has(e);return s("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[s("div",{className:"p-4 cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>R(e),children:[s("div",{className:"flex items-center justify-between mb-2",children:[t("h4",{className:"font-semibold text-gray-900 text-sm",children:e}),t("span",{className:"transform transition-transform ".concat(r?"rotate-180":""),children:"⌄"})]}),t("p",{className:"text-2xl font-bold text-blue-600",children:a.total}),t("p",{className:"text-sm text-gray-600",children:"Total Marksheets"})]}),r&&t("div",{className:"border-t border-gray-100 p-4 space-y-2",children:s("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s("div",{className:"flex items-center gap-2",children:[t("span",{className:"w-2 h-2 bg-gray-400 rounded-full"}),s("span",{children:["Draft: ",a.draft]})]}),s("div",{className:"flex items-center gap-2",children:[t("span",{className:"w-2 h-2 bg-blue-400 rounded-full"}),s("span",{children:["Verified: ",a.verified]})]}),s("div",{className:"flex items-center gap-2",children:[t("span",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),s("span",{children:["Requested: ",a.requested]})]}),s("div",{className:"flex items-center gap-2",children:[t("span",{className:"w-2 h-2 bg-green-400 rounded-full"}),s("span",{children:["Approved: ",a.approved]})]}),s("div",{className:"flex items-center gap-2",children:[t("span",{className:"w-2 h-2 bg-purple-400 rounded-full"}),s("span",{children:["Dispatched: ",a.dispatched]})]}),s("div",{className:"flex items-center gap-2",children:[t("span",{className:"w-2 h-2 bg-red-400 rounded-full"}),s("span",{children:["Issues: ",a.rejected+a.rescheduled]})]})]})})]},e)})})]}),s("div",{className:"space-y-4",children:[x!=="all"&&s("div",{className:"mb-6",children:[t("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:x}),s("p",{className:"text-gray-600",children:[b.length," marksheets found"]})]}),b.map(e=>t(V,{marksheet:e,onView:a=>O(a)},e._id))]})]})})]})})})}function Q(f={}){const n=(f.year||"").toString(),d=(f.section||"").toString();return!n&&!d?"—":d?n?n.includes("-")?n:"".concat(n,"-").concat(d):d:n}export{K as default};
