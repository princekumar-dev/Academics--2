System.register(["./index-legacy-539dcb9c.js","./react-vendor-legacy-4587369d.js","./resultUtils-legacy-0d7791a3.js"],function(e,t){"use strict";var a,s,r,l,n,i,d;return{setters:[e=>{a=e.a,s=e.b,r=e.j,l=e.F},e=>{n=e.u,i=e.r},e=>{d=e.d}],execute:function(){function t(e={}){const t=(e.year||"").toString(),a=(e.section||"").toString();return t||a?a?t?t.includes("-")?t:`${t}-${a}`:a:t:"—"}e("default",function(){const e=n(),[o]=i.useState(()=>{const e=localStorage.getItem("auth");return e?JSON.parse(e):null}),[c,m]=i.useState([]),[h,u]=i.useState(!0),[x,g]=i.useState("ALL"),[p,f]=i.useState("all"),[b,N]=i.useState(new Set),[v,y]=i.useState("");i.useEffect(()=>{if("staff"===o?.role||"hod"===o?.role){w();const e=()=>w(!0);return window.addEventListener("marksheetsUpdated",e),window.addEventListener("notificationsUpdated",e),()=>{window.removeEventListener("marksheetsUpdated",e),window.removeEventListener("notificationsUpdated",e)}}u(!1)},[o]);const w=async(e=!1)=>{if(o){u(!0);try{let t;const s=new URLSearchParams(window.location.search),r=s.get("year"),l="true"===s.get("includeAll"),n=s.get("department"),i=e?{cache:!1,dedupe:!1}:{};if("hod"!==o.role||"HNS"!==o.department||r||n)if("staff"===o.role){const e=o?._id||o?.id||localStorage.getItem("userId");t=await a.get(`/api/marksheets?staffId=${e}&includeAll=true`,i)}else"hod"===o.role&&(t=r&&l?await a.get(`/api/marksheets?year=${encodeURIComponent(r)}&includeAll=true`,i):n?await a.get(`/api/marksheets?department=${encodeURIComponent(n)}&includeAll=true`,i):await a.get(`/api/marksheets?department=${encodeURIComponent(o.department)}&includeAll=true`,i));else t=await a.get("/api/marksheets?year=I&includeAll=true",i);let d;d=t&&"function"==typeof t.json?await t.json():t,d&&d.success?m(d.marksheets||[]):Array.isArray(d)?m(d):m([])}catch(t){console.error("Error fetching marksheets:",t),m([])}finally{u(!1)}}},k=i.useMemo(()=>{const e={};return c.forEach(t=>{const a=t.examinationName||t.studentDetails?.examinationName||"Unknown Examination";e[a]||(e[a]=[]),e[a].push(t)}),Object.keys(e).forEach(t=>{e[t].sort((e,t)=>{const a=(e.studentDetails?.regNumber||"").toString().toLowerCase(),s=(t.studentDetails?.regNumber||"").toString().toLowerCase();return a.localeCompare(s,void 0,{numeric:!0,sensitivity:"base"})})}),e},[c]),S=i.useMemo(()=>{const e={};return Object.keys(k).forEach(t=>{const a=k[t];e[t]={total:a.length,draft:a.filter(e=>"draft"===e.status).length,verified:a.filter(e=>"verified_by_staff"===e.status).length,requested:a.filter(e=>"dispatch_requested"===e.status).length,approved:a.filter(e=>"approved_by_hod"===e.status).length,dispatched:a.filter(e=>"dispatched"===e.status).length,rejected:a.filter(e=>"rejected_by_hod"===e.status).length}}),e},[k]),D=i.useMemo(()=>Object.keys(k).length,[k]),C=i.useMemo(()=>{let e=[];if(e="all"===p?[...c]:k[p]||[],"hod"===o?.role&&"HNS"===o?.department&&x&&"ALL"!==x){const t=x.toString().trim().toUpperCase();e=e.filter(e=>(e.studentDetails?.department||"").toString().trim().toUpperCase()===t)}if(v.trim()){const t=v.toLowerCase().trim();e=e.filter(e=>{const a=(e.studentDetails?.name||"").toLowerCase(),s=(e.studentDetails?.regNumber||"").toLowerCase();return a.includes(t)||s.includes(t)})}return e.sort((e,t)=>{const a=(e.studentDetails?.regNumber||"").toString().toLowerCase(),s=(t.studentDetails?.regNumber||"").toString().toLowerCase();return a.localeCompare(s,void 0,{numeric:!0,sensitivity:"base"})})},[c,p,k,v,x,o]),L=i.useMemo(()=>{const e=new Set;return c.forEach(t=>{const a=t.studentDetails?.department;if(!a)return;const s=a.toString().trim().toUpperCase();s&&e.add(s)}),Array.from(e).sort()},[c]),j=e=>{N(t=>{const a=new Set(t);return a.has(e)?a.delete(e):a.add(e),a})},A=i.useCallback(e=>g(e),[]),E=i.useCallback(e=>f(e),[]),_=i.useCallback(e=>j(e),[j]),U=i.useCallback(t=>e(`/marksheets/${t}`),[e]),M=i.memo(({d:e,count:t,active:a,onSelect:r})=>s("button",{onClick:()=>r(e),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors "+(a?"bg-yellow-600 text-white":"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"),children:[e," (",t,")"]})),O=i.memo(({examName:e,count:t,active:a,onSelect:r})=>s("button",{onClick:()=>r(e),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors "+(a?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"),children:[e," (",t,")"]})),I=i.memo(({marksheet:e,onView:a})=>r("div",{className:"glass-card rounded-xl overflow-hidden",children:s("div",{className:"p-6",children:[r("div",{className:"flex items-start justify-between mb-3",children:s("div",{children:[r("h3",{className:"text-xl font-bold text-gray-900 mb-1",children:e.studentDetails?.name}),s("p",{className:"text-sm text-gray-600",children:[e.studentDetails?.regNumber," • ",t(e.studentDetails)]})]})}),s("div",{className:"flex flex-col md:grid md:grid-cols-2 lg:grid-cols-5 gap-4 md:gap-6",children:[s("div",{children:[r("p",{className:"text-gray-500 mb-1 text-xs md:text-sm",children:"Examination:"}),r("p",{className:"font-medium text-gray-900 text-sm md:text-base",children:e.examinationName||e.studentDetails?.examinationName||"—"})]}),s("div",{children:[r("p",{className:"text-gray-500 mb-1 text-xs md:text-sm",children:"Exam Date:"}),r("p",{className:"font-medium text-gray-900 text-sm md:text-base",children:e.examinationDate?new Date(e.examinationDate).toLocaleDateString("en-US",{month:"short",year:"numeric"}):e.studentDetails?.examinationDate?new Date(e.studentDetails.examinationDate).toLocaleDateString("en-US",{month:"short",year:"numeric"}):"—"})]}),s("div",{children:[r("p",{className:"text-gray-500 mb-1 text-xs md:text-sm",children:"Overall Result:"}),r("p",{className:"font-medium text-gray-900 text-sm md:text-base",children:d(e)})]}),s("div",{children:[r("p",{className:"text-gray-500 mb-1 text-xs md:text-sm",children:"Created:"}),r("p",{className:"font-medium text-gray-900 text-sm md:text-base",children:new Date(e.createdAt).toLocaleDateString()})]}),r("div",{className:"flex items-end md:justify-end",children:r("button",{onClick:()=>a(e._id),className:"w-full md:w-auto px-4 py-2 rounded-lg font-medium text-blue-600 border border-blue-200 bg-white hover:bg-blue-50 text-center text-sm transition-all duration-200 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1",children:"View Details"})})]})]})},e._id));if(!o||"staff"!==o.role&&"hod"!==o.role)return r("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 flex items-center justify-center",children:s("div",{className:"glass-card p-8 rounded-3xl text-center",children:[r("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Access Denied"}),r("p",{className:"text-gray-600",children:"Only staff members and HODs can access records."})]})});const R=c.length,$=c.filter(e=>"verified_by_staff"===e.status||"dispatch_requested"===e.status||"approved_by_hod"===e.status||"dispatched"===e.status).length;c.filter(e=>"dispatch_requested"===e.status).length;const V=c.filter(e=>"dispatched"===e.status).length;return r("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 no-mobile-anim",children:r("div",{className:"responsive-container py-6 md:py-8",children:s("div",{className:"max-w-7xl mx-auto",children:[r("div",{className:"mb-6 md:mb-8",children:r("div",{className:"glass-card no-mobile-backdrop responsive-spacing rounded-3xl",children:s("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[s("div",{children:[r("h1",{className:"text-3xl sm:text-4xl lg:text-5xl font-black text-[#111418] mb-2",children:"Marksheet Records"}),s("p",{className:"text-base sm:text-lg text-gray-600",children:["View and manage all marksheet records for ",o.department," Department"]})]}),s("div",{className:"grid grid-cols-2 sm:flex sm:flex-wrap gap-2 sm:gap-3",children:[s("div",{className:"glass-card px-3 py-2 rounded-xl text-center sm:text-left",children:[r("div",{className:"text-xs text-gray-500 whitespace-nowrap",children:"Total Exams"}),r("div",{className:"text-lg sm:text-xl md:text-2xl font-bold text-theme-gold-600",children:D})]}),s("div",{className:"glass-card px-3 py-2 rounded-xl text-center sm:text-left",children:[r("div",{className:"text-xs text-gray-500 whitespace-nowrap",children:"Total Records"}),r("div",{className:"text-lg sm:text-xl md:text-2xl font-bold text-blue-600",children:R})]}),s("div",{className:"glass-card px-3 py-2 rounded-xl text-center sm:text-left",children:[r("div",{className:"text-xs text-gray-500",children:"Verified"}),r("div",{className:"text-lg sm:text-xl md:text-2xl font-bold text-green-600",children:$})]}),s("div",{className:"glass-card px-3 py-2 rounded-xl text-center sm:text-left",children:[r("div",{className:"text-xs text-gray-500",children:"Dispatched"}),r("div",{className:"text-lg sm:text-xl md:text-2xl font-bold text-purple-600",children:V})]})]})]})})}),r("div",{className:"glass-card p-4 sm:p-6 md:p-8 rounded-2xl md:rounded-3xl mb-8",children:h?s("div",{className:"text-center py-12",children:[r("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),r("p",{className:"text-gray-600",children:"Loading marksheet records..."})]}):0===c.length?s("div",{className:"text-center py-12",children:[r("svg",{className:"w-16 h-16 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),r("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Records Found"}),r("p",{className:"text-gray-600",children:"Start by importing marks to create your first marksheet records."})]}):s(l,{children:[s("div",{className:"mb-8",children:[s("div",{className:"relative max-w-2xl",children:[r("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:r("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),r("input",{type:"text",placeholder:"Search name or register no...",value:v,onChange:e=>y(e.target.value),className:"w-full pl-12 pr-12 py-3.5 rounded-xl border border-gray-200 bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm md:text-base transition-shadow shadow-sm hover:shadow-md placeholder:text-sm md:placeholder:text-base"}),v&&r("button",{onClick:()=>y(""),className:"absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 hover:text-gray-600 transition-colors","aria-label":"Clear search",children:r("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),v&&r("p",{className:"mt-3 text-sm text-gray-600 font-medium",children:C.length>0?`Found ${C.length} result${1!==C.length?"s":""}`:"No results found"})]}),"hod"===o?.role&&"HNS"===o?.department&&s("div",{className:"mb-6",children:[r("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Filter by Department"}),s("div",{className:"flex flex-wrap gap-2",children:[s("button",{onClick:()=>g("ALL"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors "+("ALL"===x?"bg-yellow-600 text-white":"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"),children:["All Departments (",c.length,")"]}),L.map(e=>r(M,{d:e,count:c.filter(t=>(t.studentDetails?.department||"").toString().trim().toUpperCase()===e).length,active:x===e,onSelect:A},e))]})]}),s("div",{className:"mb-8",children:[r("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Filter by Examination"}),s("div",{className:"flex flex-wrap gap-2",children:[s("button",{onClick:()=>f("all"),className:"px-4 py-2 rounded-lg text-sm font-medium transition-colors "+("all"===p?"bg-blue-600 text-white":"bg-white text-gray-700 border border-gray-200 hover:bg-gray-50"),children:["All Examinations (",c.length,")"]}),Object.keys(k).sort().map(e=>r(O,{examName:e,count:k[e].length,active:p===e,onSelect:E},e))]})]}),"all"===p&&s("div",{className:"mb-8",children:[r("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Examination Overview"}),r("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.keys(k).sort().map(e=>{const t=S[e],a=b.has(e);return s("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden",children:[s("div",{className:"p-4 cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>_(e),children:[s("div",{className:"flex items-center justify-between mb-2",children:[r("h4",{className:"font-semibold text-gray-900 text-sm",children:e}),r("span",{className:"transform transition-transform "+(a?"rotate-180":""),children:"⌄"})]}),r("p",{className:"text-2xl font-bold text-blue-600",children:t.total}),r("p",{className:"text-sm text-gray-600",children:"Total Marksheets"})]}),a&&r("div",{className:"border-t border-gray-100 p-4 space-y-2",children:s("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s("div",{className:"flex items-center gap-2",children:[r("span",{className:"w-2 h-2 bg-gray-400 rounded-full"}),s("span",{children:["Draft: ",t.draft]})]}),s("div",{className:"flex items-center gap-2",children:[r("span",{className:"w-2 h-2 bg-blue-400 rounded-full"}),s("span",{children:["Verified: ",t.verified]})]}),s("div",{className:"flex items-center gap-2",children:[r("span",{className:"w-2 h-2 bg-yellow-400 rounded-full"}),s("span",{children:["Requested: ",t.requested]})]}),s("div",{className:"flex items-center gap-2",children:[r("span",{className:"w-2 h-2 bg-green-400 rounded-full"}),s("span",{children:["Approved: ",t.approved]})]}),s("div",{className:"flex items-center gap-2",children:[r("span",{className:"w-2 h-2 bg-purple-400 rounded-full"}),s("span",{children:["Dispatched: ",t.dispatched]})]}),s("div",{className:"flex items-center gap-2",children:[r("span",{className:"w-2 h-2 bg-red-400 rounded-full"}),s("span",{children:["Issues: ",t.rejected+t.rescheduled]})]})]})})]},e)})})]}),s("div",{className:"space-y-4",children:["all"!==p&&s("div",{className:"mb-6",children:[r("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:p}),s("p",{className:"text-gray-600",children:[C.length," marksheets found"]})]}),C.map(e=>r(I,{marksheet:e,onView:e=>U(e)},e._id))]})]})})]})})})})}}});
