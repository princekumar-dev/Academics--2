import{j as n,u as v,b as a,a as g}from"./index-a36099b1.js";import{N as S,r}from"./react-vendor-ad4d5528.js";function L(){const i=localStorage.getItem("auth"),s=i?JSON.parse(i):null;if(!s||s.role!=="staff")return n(S,{to:"/home",replace:!0});const{showSuccess:p,showError:c}=v(),[o,x]=r.useState([]),[w,d]=r.useState(!1),m=async()=>{try{d(!0);const e=new URLSearchParams({department:s.department,type:"late",status:"requested"}),t=await g.get("/api/leaves?".concat(e.toString()));if(t.success){const l=(t.requests||[]).filter(u=>{var h,f;return((h=u.studentDetails)==null?void 0:h.year)===s.year&&((f=u.studentDetails)==null?void 0:f.section)===s.section});x(l)}}catch(e){}finally{d(!1)}};r.useEffect(()=>{m()},[]);const y=async e=>{try{const t=await g.patch("/api/leaves?id=".concat(e,"&action=acknowledge"),{staffId:s.id});t&&t.success?(p("Acknowledged","Late arrival recorded and parent notified"),m()):c("Failed",(t==null?void 0:t.error)||"Could not acknowledge request")}catch(t){c("Error",t.message)}},N=e=>e?new Date(e).toLocaleString("en-IN",{dateStyle:"medium",timeStyle:"short"}):"-";return a("div",{className:"px-4 py-4 w-full max-w-4xl mx-auto",children:[n("h1",{className:"text-2xl font-bold mb-4",children:"Late Acknowledgment"}),w?n("div",{className:"p-4 text-gray-500",children:"Loading..."}):a("ul",{className:"divide-y bg-white rounded-xl shadow",children:[o.map(e=>{var t,l;return a("li",{className:"p-4 flex items-center justify-between",children:[a("div",{children:[a("div",{className:"font-medium",children:[(t=e.studentDetails)==null?void 0:t.name," (",(l=e.studentDetails)==null?void 0:l.regNumber,")"]}),a("div",{className:"text-sm text-gray-600",children:["Expected: ",N(e.expectedArrivalTime)]}),a("div",{className:"text-sm text-gray-600",children:["Reason: ",e.reason]})]}),n("div",{className:"flex gap-2",children:n("button",{onClick:()=>y(e._id),className:"px-3 py-2 text-sm rounded-lg bg-blue-600 text-white",children:"Record Arrival"})})]},e._id)}),o.length===0&&n("li",{className:"p-4 text-gray-500",children:"No pending late notifications."})]})]})}export{L as default};
