System.register(["./index-legacy-b6735175.js","./react-vendor-legacy-4587369d.js","./RefreshButton-legacy-7bada89f.js","./Confetti-legacy-98c8a395.js","./ContextualHelp-legacy-40920656.js","./usePullToRefresh-legacy-6e4f4bfc.js"],function(e,t){"use strict";var r,s,a,n,i,o,l,d,c,u,p,h,m,g,f,x;return{setters:[e=>{r=e.u,s=e.d,a=e.e,n=e.a,i=e.j,o=e.b,l=e.F,d=e.S,c=e._},e=>{u=e.r,p=e.u},e=>{h=e.R},e=>{m=e.u},e=>{g=e.H},e=>{f=e.u,x=e.P}],execute:function(){function b({open:e,type:t,marksheet:r,anchorRect:s,onClose:a,onSubmit:n,loading:l,error:d}){const[c,p]=u.useState(""),[h,m]=u.useState(()=>"undefined"==typeof window||window.innerWidth<640),[g,f]=u.useState(e);if(u.useEffect(()=>{const e=()=>m(window.innerWidth<640);return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),u.useEffect(()=>{if(!e){const e=setTimeout(()=>f(!1),120);return()=>clearTimeout(e)}f(!0)},[e]),u.useEffect(()=>{e&&r&&p("")},[e,t,r]),!g||!r)return null;const x="approved"===t?"Approve dispatch request":"Reject dispatch request",b=(()=>{if("undefined"==typeof window)return{width:"100%",maxWidth:"100%",borderRadius:"24px 24px 0 0",position:"fixed",left:0,right:0,bottom:0,margin:"0 auto"};if(["rejected","approved"].includes(t)){const e=16,t=Math.min(420,window.innerWidth-2*e),r=window.innerWidth;return{width:t,position:"absolute",left:Math.max(e,Math.min((r-t)/2,r-t-e)),top:Math.max(window.scrollY+e,window.scrollY+80)}}if(h||!s)return{width:"100%",maxWidth:"100%",borderRadius:"24px 24px 0 0",position:"fixed",left:0,right:0,bottom:0,margin:"0 auto"};const e=16,r=420,a=window.innerWidth,n=window.innerHeight;if("rejected"===t||"approved"===t)return{width:r,position:"absolute",left:Math.max(e,Math.min((a-r)/2,a-r-e)),top:Math.max(window.scrollY+e,window.scrollY+120)};let i=s.left+s.width+12;i+r>a-e&&(i=s.left-r-12,i<e&&(i=Math.min(Math.max(e,s.left+s.width/2-210),a-r-e)));let o=s.top+s.height+12;return o>window.scrollY+n-24-380&&(o=Math.max(window.scrollY+e,s.top-380-12)),{width:r,position:"absolute",left:i,top:o}})(),y=(e=!1)=>{e&&f(!1);try{a()}catch(t){}},w=e?"opacity-100":"opacity-0",v=e?"":"pointer-events-none",N=e?"translate-y-0 rounded-t-2xl":"translate-y-full rounded-t-2xl",S=e?"translate-y-0 scale-100":"translate-y-2 scale-95",k=["rejected","approved"].includes(t);return i("div",{className:`fixed inset-0 z-50 flex items-start justify-center bg-black/40 px-4 py-6 sm:py-10 ${w} ${v}`,onClick:e=>{e.target===e.currentTarget&&y(!1)},style:{transition:"opacity 100ms cubic-bezier(0.2,0,0,1)"},children:o("div",{className:`glass-card w-full p-6 shadow-2xl transition-all duration-100 ${h&&k?"rounded-xl shadow-lg":""} ${k?S:h?N:S}`,style:b,children:[o("div",{className:"mb-4",children:[i("h3",{className:"text-xl font-semibold text-gray-900",children:x}),o("p",{className:"text-sm text-gray-600 mt-1",children:[r.studentDetails?.name," â€¢ ",r.studentDetails?.regNumber]})]}),o("form",{onSubmit:e=>{e.preventDefault();const t={comments:c.trim()||void 0};try{y(!0)}catch(r){}n(t)},className:"space-y-4",children:[o("div",{children:[i("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Comments (optional)"}),i("textarea",{value:c,onChange:e=>p(e.target.value),rows:4,className:"w-full rounded-lg border border-gray-200 px-3 py-2 focus:border-blue-500 focus:outline-none",placeholder:"rejected"===t?"Let the staff know the reason for rejection":"Add any notes for the staff member"})]}),d&&i("div",{className:"rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:d}),o("div",{className:`flex ${h?"flex-col-reverse gap-2":"justify-end gap-3"} pt-2`,children:[i("button",{type:"button",onClick:()=>y(!0),className:"px-4 py-2 rounded-lg border border-gray-200 text-gray-700 hover:bg-gray-100 "+(h?"w-full text-center":""),children:"Cancel"}),i("button",{type:"submit",disabled:l,className:`px-5 py-2 rounded-lg text-white ${l?"bg-blue-300 cursor-wait":"bg-blue-600 hover:bg-blue-700"} ${h?"w-full text-center":""}`,children:l?"Saving...":"Confirm"})]})]})]})})}e("default",function(){const{showSuccess:e,showError:y,showWarning:w}=r(),{celebrate:v,ConfettiContainer:N}=m(),[S,k]=u.useState(()=>{try{const e=localStorage.getItem("auth");return e?JSON.parse(e):null}catch(e){return console.error("Failed to parse auth data:",e),null}}),[q,C]=u.useState([]),[E,_]=u.useState(!0),[j,D]=u.useState("all"),[R,$]=u.useState({open:!1,type:null,marksheet:null,anchorRect:null}),[A,I]=u.useState(!1),[L,M]=u.useState(""),[H,P]=u.useState(""),[U,F]=u.useState(!1),[W,T]=u.useState(!1),[Y,O]=u.useState([]),B={AI_DS:"AI & DS",CSE:"CSE",IT:"IT",ECE:"ECE",EEE:"EEE",MECH:"MECH",CIVIL:"CIVIL",HNS:"H&S"},z={CSE:"bg-blue-100 text-blue-800",AI_DS:"bg-indigo-100 text-indigo-800",ECE:"bg-teal-100 text-teal-800",IT:"bg-green-100 text-green-800",MECH:"bg-amber-100 text-amber-800",CIVIL:"bg-red-100 text-red-800",EEE:"bg-purple-100 text-purple-800",HNS:"bg-yellow-50 text-yellow-800"},V=p(),{isPulling:J,isRefreshing:Q,pullDistance:X,containerRef:G,threshold:K}=f(async()=>{await ee(),e("ðŸ”„ Refreshed","Approval requests updated")},{enabled:!0,threshold:80}),Z=async()=>{if(S)try{const e=new URLSearchParams({department:S.department,type:"leave"}),t=await n.get(`/api/leaves?${e.toString()}`);if(t.success){const e=(t.requests||[]).filter(e=>"requested"===e.status);O(e)}else O([])}catch(e){console.error("Error fetching leave requests:",e),O([])}};u.useEffect(()=>{"hod"===S?.role?(ee(),Z()):_(!1);const e=()=>{try{const e=localStorage.getItem("auth"),t=e?JSON.parse(e):null;k(t),"hod"===t?.role&&(ee(!0),Z())}catch(e){console.error("[ApprovalRequests] authStateChanged handler error:",e)}};return window.addEventListener("authStateChanged",e),()=>window.removeEventListener("authStateChanged",e)},[S]),s({leave_request:()=>{console.log("ðŸ”” Leave request notification triggered refresh"),Z()},leave_approval:()=>{console.log("ðŸ”” Leave approval notification triggered refresh"),Z()},marksheet_approval:()=>{console.log("ðŸ”” Marksheet approval notification triggered refresh"),ee()},dispatch_request:()=>{console.log("ðŸ”” Dispatch request notification triggered refresh"),ee()}}),a(()=>{ee(),Z()});const ee=async(e=!1)=>{if(S){_(!0);try{let t;const r=e?{cache:!1,dedupe:!1}:{};"HNS"===S.department?(console.log("[ApprovalRequests] HNS HOD detected â€” fetching Year I pending requests across departments"),t=await n.get("/api/marksheets?year=I&status=dispatch_requested",r)):(console.log("[ApprovalRequests] Fetching with department:",S.department),t=await n.get(`/api/marksheets?department=${S.department}&status=dispatch_requested`,r)),console.log("[ApprovalRequests] Response:",t),t&&t.success?C(t.marksheets):C([])}catch(t){console.error("Error fetching pending requests:",t),C([])}finally{_(!1)}}},te=async()=>{try{if(S?.eSignature)return S;const t=S?._id||S?.id;if(!t)return null;const r=await n.get(`/api/users?action=profile&userId=${t}`);if(r?.success&&r.user){const t={...S,...r.user};try{localStorage.setItem("auth",JSON.stringify(t))}catch(e){}return k(t),t}}catch(e){console.error("[ApprovalRequests] Failed to refresh HOD profile:",e)}return S},re=(e,t,r)=>{const s="undefined"!=typeof window,a=e?.currentTarget?.getBoundingClientRect(),n=a&&s?{top:a.top+window.scrollY,left:a.left+window.scrollX,width:a.width,height:a.height}:null;M(""),$({open:!0,type:r,marksheet:t,anchorRect:n})},se=()=>{$({open:!1,type:null,marksheet:null,anchorRect:null}),M("")},ae=async r=>{const s=ie.filter(e=>"dispatch_requested"===e.status);if(0!==s.length)try{const o=await te();if(!o?.eSignature)return void y("Signature Missing","Please add your signature in Settings before approving requests");F(!0),M("");const l=S._id||S.id,d=s.map(e=>n.post("/api/marksheets?action=hod-response",{marksheetId:e._id,hodId:l,response:r,comments:""},{dispatch:!1}).then(e=>e).catch(e=>({success:!1,error:e.message}))),u=await Promise.all(d),p=u.filter(e=>e.success).length,h=u.length-p;if(p>0)P(`Successfully ${r} ${p} request${p>1?"s":""}.${h>0?` ${h} failed.`:""}`),e(`Bulk ${r.charAt(0).toUpperCase()+r.slice(1)}`,`${p}/${u.length} requests processed successfully`),0===h&&v();else{const e=`Failed to ${r.slice(0,-1)} any requests. Please try again.`;M(e),y("Bulk Action Failed",e)}try{C(e=>e.filter(e=>!s.some(t=>t._id===e._id)))}catch(a){}try{c(()=>t.import("./notificationEvents-legacy-ed9f7877.js"),void 0).then(e=>e.notifyNotificationsUpdated())}catch(a){try{window.dispatchEvent(new Event("notificationsUpdated"))}catch(i){}}try{window.dispatchEvent(new Event("marksheetsUpdated"))}catch(a){}try{window.refreshNotificationCount&&window.refreshNotificationCount()}catch(a){}await ee(!0)}catch(o){M(o.message||`Failed to perform bulk ${r}`)}finally{F(!1)}else P(`No pending requests available for bulk ${r}.`)},ne=u.useMemo(()=>[{id:"all",label:"All",count:q.length},{id:"dispatch_requested",label:"Pending",count:q.filter(e=>"dispatch_requested"===e.status).length}],[q]),ie=u.useMemo(()=>("all"===j?q:q.filter(e=>e.status===j)).sort((e,t)=>{const r=(e.studentDetails?.regNumber||"").toString().toLowerCase(),s=(t.studentDetails?.regNumber||"").toString().toLowerCase();return r.localeCompare(s,void 0,{numeric:!0,sensitivity:"base"})}),[q,j]),oe={dispatch_requested:"bg-yellow-100 text-yellow-800",approved_by_hod:"bg-green-100 text-green-800",rejected_by_hod:"bg-red-100 text-red-800",dispatched:"bg-purple-100 text-purple-800"},le={dispatch_requested:"â³",approved_by_hod:"âœ…",rejected_by_hod:"â›”",dispatched:"ðŸ“¤"},de=(e={})=>{const t=(e.year||"").toString(),r=(e.section||"").toString();return t||r?r?t?`${t}-${r}`:r:t:"N/A"};return S&&"hod"===S.role?o("div",{ref:G,className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:[i(x,{pullDistance:X,threshold:K,isRefreshing:Q}),i("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:o("div",{className:"max-w-6xl mx-auto",children:[o("div",{className:"text-center mb-8",children:[i("h1",{className:"text-4xl sm:text-5xl lg:text-6xl font-black text-gray-900 mb-4",children:"Approval Requests"}),o("p",{className:"text-lg text-gray-600 max-w-3xl mx-auto",children:["Review and approve dispatch requests for ",S.department," Department"]})]}),Y.length>0&&i("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-xl",children:o("p",{className:"text-sm text-blue-700",children:["ðŸ’¡ ",i("strong",{children:"Note:"})," Leave request approvals have been moved to your notification inbox. Click the ðŸ”” bell icon to review leave requests alongside staff account approvals."]})}),i("div",{className:"glass-card p-4 sm:p-6 md:p-8 rounded-2xl md:rounded-3xl mb-8",children:E?o("div",{className:"text-center py-12",children:[i("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),i("p",{className:"text-gray-600",children:"Loading pending requests..."})]}):0===q.length?o("div",{className:"text-center py-12",children:[i("svg",{className:"w-16 h-16 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:i("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),i("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No pending requests"}),i("p",{className:"text-gray-600",children:"All dispatch requests have been processed"})]}):o(l,{children:[i("div",{className:"flex flex-wrap items-center gap-3 mb-6",children:ne.map(e=>o("button",{onClick:()=>D(e.id),className:"px-4 py-2 rounded-full text-sm font-medium border transition-all duration-200 "+(j===e.id?"bg-blue-600 text-white border-blue-600":"bg-white text-gray-700 border-gray-200 hover:border-blue-400"),children:[e.label,i("span",{className:"ml-2 inline-flex items-center justify-center px-2 py-0.5 rounded-full text-xs font-semibold "+(j===e.id?"bg-white/25 text-white":"bg-gray-100 text-gray-700"),children:e.count})]},e.id))}),H&&i("div",{className:"mb-6 rounded-xl border border-green-200 bg-green-50 px-4 py-3 text-sm text-green-800",children:H}),L&&i("div",{className:"mb-6 rounded-xl border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-800",children:L}),o("div",{className:"mb-6 p-3 sm:p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-100",children:[o("div",{className:"flex items-start justify-between gap-4 mb-3",children:[i("div",{className:"flex items-center gap-2",children:o("div",{children:[o("div",{className:"flex items-center gap-2",children:[i("h3",{className:"text-sm font-semibold text-gray-900",children:"Bulk Actions"}),i(g,{content:"Quickly approve or reject all pending dispatch requests at once."})]}),o("p",{className:"text-xs text-gray-600",children:[ie.filter(e=>"dispatch_requested"===e.status).length," pending requests available"]})]})}),i(h,{isLoading:W,onClick:async()=>{T(!0);try{await ee()}finally{T(!1)}}})]}),o("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3",children:[i("button",{onClick:()=>ae("approved"),disabled:U||0===ie.filter(e=>"dispatch_requested"===e.status).length,className:"px-3 sm:px-4 py-2 rounded-lg font-medium text-white text-xs sm:text-sm transition-all duration-200 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-1 "+(U||0===ie.filter(e=>"dispatch_requested"===e.status).length?"bg-gray-300 cursor-not-allowed":"bg-green-600 hover:bg-green-700"),children:o("span",{className:"flex items-center justify-center gap-1",children:[i("span",{children:"âœ…"}),i("span",{children:U?"Processing...":"Approve All"})]})}),i("button",{onClick:()=>ae("rejected"),disabled:U||0===ie.filter(e=>"dispatch_requested"===e.status).length,className:"px-3 sm:px-4 py-2 rounded-lg font-medium text-white text-xs sm:text-sm transition-all duration-200 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-1 "+(U||0===ie.filter(e=>"dispatch_requested"===e.status).length?"bg-gray-300 cursor-not-allowed":"bg-red-600 hover:bg-red-700"),children:o("span",{className:"flex items-center justify-center gap-1",children:[i("span",{children:"â›”"}),i("span",{children:U?"Processing...":"Reject All"})]})})]})]}),i("div",{className:"space-y-4",children:ie.map(e=>i(d,{actions:[{label:"Details",icon:"ðŸ‘ï¸",className:"border-slate-300 text-slate-600 hover:border-slate-500 hover:bg-slate-50",onClick:()=>V(`/marksheets/${e._id||e.marksheetId}`)},{label:"Reject",icon:"âŒ",className:"border-red-300 text-red-600 hover:border-red-500 hover:bg-red-50",onClick:t=>re(t,e,"rejected")},{label:"Approve",icon:"âœ…",className:"border-green-300 text-green-600 hover:border-green-500 hover:bg-green-50",onClick:t=>re(t,e,"approved")}],children:o("div",{className:"bg-white",children:[o("div",{className:"p-4 sm:p-6 pb-3 sm:pb-4",children:[o("div",{className:"flex items-start justify-between mb-3 gap-2",children:[o("div",{className:"flex-1 min-w-0",children:[i("h3",{className:"text-lg sm:text-xl font-bold text-gray-900 mb-1 truncate",children:e.studentDetails?.name}),o("p",{className:"text-xs sm:text-sm text-gray-600 flex items-center gap-2",children:[o("span",{children:[e.studentDetails?.regNumber," â€¢ ",de(e.studentDetails)]}),e.studentDetails?.department&&i("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[10px] font-semibold uppercase ${z[e.studentDetails.department]||"bg-gray-100 text-gray-800"}`,children:B[e.studentDetails?.department]||(e.studentDetails?.department||"").toUpperCase()})]})]}),o("span",{className:`px-2 py-1 sm:px-3 sm:py-1.5 rounded-full text-xs font-semibold uppercase tracking-wide flex items-center gap-1 whitespace-nowrap ${oe[e.status]||"bg-yellow-100 text-yellow-800"}`,children:[i("span",{className:"text-xs sm:text-sm",children:le[e.status]||"ðŸ“„"}),i("span",{className:"text-xs",children:(e.status||"").replace(/_/g," ")})]})]}),o("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 md:gap-6 text-xs sm:text-sm",children:[o("div",{children:[i("p",{className:"text-gray-500 mb-1",children:"Staff:"}),i("p",{className:"font-medium text-gray-900 truncate",children:e.staffName||"demo staff"})]}),o("div",{children:[i("p",{className:"text-gray-500 mb-1",children:"Parent Phone:"}),i("p",{className:"font-medium text-gray-900",children:e.studentDetails?.parentPhoneNumber||"â€”"})]}),o("div",{children:[i("p",{className:"text-gray-500 mb-1",children:"Exam Date:"}),i("p",{className:"font-medium text-gray-900",children:e.examinationDate?new Date(e.examinationDate).toLocaleDateString("en-US",{month:"short",year:"numeric"}):"â€”"})]}),o("div",{children:[i("p",{className:"text-gray-500 mb-1",children:"Subjects:"}),i("p",{className:"font-medium text-gray-900",children:e.subjects?.length||0})]})]})]}),i("div",{className:"border-t border-gray-100"}),i("div",{className:"hidden sm:block p-4 sm:p-6 pt-3 sm:pt-4 bg-gray-50",children:o("div",{className:"grid grid-cols-4 gap-3",children:[i("button",{onClick:t=>re(t,e,"approved"),className:"px-4 py-2.5 bg-green-600 hover:bg-green-700 text-white text-sm font-medium rounded-lg transition-all duration-200 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-1",children:"Approve Dispatch"}),i("button",{onClick:t=>re(t,e,"rejected"),className:"px-4 py-2.5 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg transition-all duration-200 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-1",children:"Reject Request"}),i("button",{onClick:()=>V(`/marksheets/${e._id||e.marksheetId}`),className:"px-4 py-2.5 bg-white hover:bg-gray-50 text-gray-700 text-sm font-medium rounded-lg border border-gray-300 transition-all duration-200 shadow-sm hover:shadow focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-1",children:"View Details"})]})}),i("div",{className:"sm:hidden p-3 bg-gradient-to-r from-blue-50 to-indigo-50 border-t border-blue-100",children:o("p",{className:"text-xs text-center text-gray-600 flex items-center justify-center gap-2",children:[i("span",{children:"ðŸ‘ˆ"}),i("span",{className:"font-medium",children:"Swipe left for actions"})]})})]})},e._id))})]})})]})}),i(b,{open:R.open,type:R.type,marksheet:R.marksheet,anchorRect:R.anchorRect,onClose:se,onSubmit:async({comments:r})=>{if(R.marksheet&&R.type)try{I(!0);const i=await te();if(!i?.eSignature)return y("Signature Missing","Please add your signature in Settings before approving requests"),void I(!1);const o=S._id||S.id,l=await n.post("/api/marksheets?action=hod-response",{marksheetId:R.marksheet._id,hodId:o,response:R.type,comments:r},{dispatch:!1});if(!l||!l.success)throw new Error(l?.error||"Failed to submit response");const d="approved"===R.type?"approved":"rejected",u=R.marksheet?.studentDetails?.name||"Student";P(`Dispatch request ${d} successfully.`),"approved"===R.type?e("âœ“ Approved",`Dispatch approved for ${u}`):w("Request Rejected",`Dispatch rejected for ${u}`),se();try{C(e=>e.filter(e=>e._id!==R.marksheet._id))}catch(s){}try{c(()=>t.import("./notificationEvents-legacy-ed9f7877.js"),void 0).then(e=>e.notifyNotificationsUpdated())}catch(s){try{window.dispatchEvent(new Event("notificationsUpdated"))}catch(a){}}try{window.dispatchEvent(new Event("marksheetsUpdated"))}catch(s){}try{window.refreshNotificationCount&&window.refreshNotificationCount()}catch(s){}await ee(!0)}catch(i){M(i.message||"Unexpected error"),y("Action Failed",i.message||"Could not process the request")}finally{I(!1)}},loading:A,error:L}),i(N,{})]}):i("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 flex items-center justify-center",children:o("div",{className:"glass-card p-8 rounded-3xl text-center",children:[i("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Access Denied"}),i("p",{className:"text-gray-600",children:"Only HODs can approve dispatch requests."})]})})})}}});
