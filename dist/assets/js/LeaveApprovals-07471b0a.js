import{j as r,u as b,b as s,a as g}from"./index-a36099b1.js";import{N,r as d}from"./react-vendor-ad4d5528.js";import{u as y}from"./usePullToRefresh-291be9c1.js";function L(){const u=localStorage.getItem("auth"),l=u?JSON.parse(u):null;if(!l||l.role!=="hod")return r(N,{to:"/home",replace:!0});const{showSuccess:v,showError:o}=b(),[p,x]=d.useState([]),[c,m]=d.useState(!1),[i,f]=d.useState(null),n=async()=>{var t;try{m(!0);const a=new URLSearchParams({department:l.department,type:"leave",status:"requested"});console.log("[LeaveApprovals] Fetching with:",{department:l.department,type:"leave",status:"requested"});const e=await g.get("/api/leaves?".concat(a.toString()));console.log("[LeaveApprovals] Response:",e),e.success?(x(e.requests||[]),f({filter:e.filter,count:((t=e.requests)==null?void 0:t.length)||0,hodDept:l.department})):o("Failed to load",e.error||"Could not fetch requests")}catch(a){console.error("[LeaveApprovals] Error:",a),o("Error",a.message)}finally{m(!1)}};d.useEffect(()=>{n()},[]),y(n);const h=async(t,a)=>{try{const e=await g.patch("/api/leaves?id=".concat(t,"&action=").concat(a),{hodId:l.id});e&&e.success?(v(a==="approve"?"Approved":"Rejected","Request updated"),n()):o("Failed",(e==null?void 0:e.error)||"Could not update request")}catch(e){o("Error",e.message)}};return s("div",{className:"px-4 py-4 w-full max-w-4xl mx-auto",children:[s("div",{className:"flex items-center justify-between mb-4",children:[r("h1",{className:"text-2xl font-bold",children:"Leave Approvals"}),r("button",{onClick:n,className:"px-3 py-2 text-sm rounded-lg border bg-white hover:bg-gray-50",disabled:c,children:c?"Loading...":"Refresh"})]}),i&&s("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg text-xs",children:[s("div",{children:["HOD Dept: ",i.hodDept]}),s("div",{children:["Found: ",i.count," requests"]})]}),c?r("div",{className:"p-4 text-gray-500",children:"Loading..."}):s("ul",{className:"divide-y bg-white rounded-xl shadow",children:[p.map(t=>{var a,e;return s("li",{className:"p-4 flex items-center justify-between",children:[s("div",{children:[s("div",{className:"font-medium",children:[(a=t.studentDetails)==null?void 0:a.name," (",(e=t.studentDetails)==null?void 0:e.regNumber,")"]}),s("div",{className:"text-sm text-gray-600",children:[new Date(t.startDate).toLocaleDateString()," â†’ ",new Date(t.endDate).toLocaleDateString()]}),s("div",{className:"text-sm text-gray-600",children:["Reason: ",t.reason]})]}),s("div",{className:"flex gap-2",children:[r("button",{onClick:()=>h(t._id,"approve"),className:"px-3 py-2 text-sm rounded-lg bg-green-600 text-white",children:"Approve"}),r("button",{onClick:()=>h(t._id,"reject"),className:"px-3 py-2 text-sm rounded-lg bg-red-600 text-white",children:"Reject"})]})]},t._id)}),p.length===0&&r("li",{className:"p-4 text-gray-500",children:"No pending requests."})]})]})}export{L as default};
