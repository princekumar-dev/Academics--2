import{a as b,j as e,b as a,S as y}from"./index-ba65f9b1.js";import{r as c,L as w}from"./react-vendor-ad4d5528.js";function S(){const[s,m]=c.useState(null),[u,f]=c.useState([]),[N,p]=c.useState(!0);c.useEffect(()=>{const t=localStorage.getItem("auth");if(!t)return;try{const r=JSON.parse(t);if(r.role!=="student")return;g(r,!0),h(r,!0)}catch(r){console.error("Invalid auth data",r)}const d=()=>{try{const r=localStorage.getItem("auth");if(!r)return;const l=JSON.parse(r);if(l.role!=="student")return;h(l,!0)}catch(r){}},n=()=>{try{const r=localStorage.getItem("auth");if(!r)return;const l=JSON.parse(r);if(l.role!=="student")return;g(l,!0),h(l,!0)}catch(r){console.error("authStateChanged handler error",r)}};return window.addEventListener("marksheetsUpdated",d),window.addEventListener("notificationsUpdated",d),window.addEventListener("authStateChanged",n),()=>{window.removeEventListener("marksheetsUpdated",d),window.removeEventListener("notificationsUpdated",d),window.removeEventListener("authStateChanged",n)}},[]);const g=async(t,d=!1)=>{try{const n=encodeURIComponent(t.phoneNumber||t.parentPhoneNumber),r=encodeURIComponent(t.regNumber||""),l=d?{cache:!1,dedupe:!1}:{},i=await b.get("/api/users?studentPhoneNumber=".concat(n,"&regNumber=").concat(r),l);if(i.success&&i.user){const o={...t,...i.user,role:"student"};m(o)}else m(t)}catch(n){console.error("Failed to fetch student data:",n),m(t)}},h=async(t,d=!1)=>{p(!0);try{const n=new URLSearchParams;t.id&&n.set("studentId",t.id),t.regNumber&&n.set("regNumber",t.regNumber),t.phoneNumber&&n.set("phoneNumber",t.phoneNumber);const r=d?{cache:!1,dedupe:!1}:{},l=await b.get("/api/marksheets?".concat(n.toString()),r);if(l.success){const i=(l.marksheets||[]).filter(o=>o.status==="dispatched");f(i)}}catch(n){console.error("Failed to load student marksheets",n)}finally{p(!1)}};return e("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:a("div",{className:"max-w-5xl mx-auto px-4 py-8",children:[e("div",{className:"glass-card p-8 rounded-3xl mb-8 backdrop-blur-lg border border-white/20 shadow-lg",children:a("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[a("div",{children:[e("p",{className:"text-xs font-semibold text-blue-600 uppercase tracking-wider",children:"Student Dashboard"}),e("h1",{className:"text-4xl font-bold text-gray-900 mt-2",children:s==null?void 0:s.name}),a("div",{className:"mt-6 space-y-2",children:[a("p",{className:"text-sm text-gray-600",children:["Registration: ",e("span",{className:"font-semibold text-gray-900",children:s==null?void 0:s.regNumber})]}),a("p",{className:"text-sm text-gray-600",children:["Department: ",e("span",{className:"font-semibold text-gray-900",children:(s==null?void 0:s.department)||"AI_DS"})]}),a("p",{className:"text-sm text-gray-600",children:["Year: ",e("span",{className:"font-semibold text-gray-900",children:s==null?void 0:s.year})," | Section: ",e("span",{className:"font-semibold text-gray-900",children:s==null?void 0:s.section})]})]})]}),a("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 rounded-2xl p-6 border border-blue-100",children:[e("p",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Contact Information"}),e("div",{className:"mt-4",children:a("div",{children:[e("p",{className:"text-xs text-gray-500 uppercase tracking-wide font-semibold",children:"Parent's Phone"}),e("p",{className:"text-lg font-bold text-gray-900 mt-1",children:(s==null?void 0:s.parentPhoneNumber)||"N/A"})]})})]})]})}),a("div",{className:"glass-card p-8 rounded-3xl backdrop-blur-lg border border-white/20 shadow-lg",children:[a("div",{className:"flex items-center justify-between mb-8",children:[a("div",{children:[e("h2",{className:"text-2xl font-bold text-gray-900",children:"Your Marksheets"}),e("p",{className:"text-sm text-gray-500 mt-1",children:"Swipe left to download or view"})]}),e(w,{to:"/contact",className:"text-blue-600 text-sm font-semibold hover:text-blue-700 transition-colors",children:"Need help?"})]}),N?e("div",{className:"flex items-center justify-center py-12",children:a("div",{className:"text-center",children:[e("div",{className:"inline-block w-8 h-8 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"}),e("p",{className:"text-gray-600 mt-3",children:"Loading your marksheets..."})]})}):u.length===0?a("div",{className:"text-center py-16",children:[e("div",{className:"w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center",children:e("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"})})}),e("p",{className:"text-gray-600 font-medium",children:"No marksheets yet"}),e("p",{className:"text-gray-500 text-sm mt-1",children:"Your marksheets will appear here once they are dispatched"})]}):e("div",{className:"space-y-4",children:u.map(t=>{var n,r,l,i,o,x;return e(y,{actions:[{label:"Download",icon:"ðŸ“¥",onClick:()=>{window.open("/api/generate-pdf?marksheetId=".concat(t._id),"_blank")},className:"bg-blue-600"}],children:a("div",{className:"bg-white",children:[a("div",{className:"p-6",children:[a("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 mb-4",children:[a("div",{className:"flex-1 min-w-0",children:[e("h3",{className:"text-lg sm:text-xl font-bold text-gray-900 mb-1 break-words",children:((n=t.studentDetails)==null?void 0:n.examinationName)||"Examination"}),a("p",{className:"text-xs sm:text-sm text-gray-600",children:[(r=t.studentDetails)==null?void 0:r.regNumber," â€¢ ",(l=t.studentDetails)==null?void 0:l.year,"-",(i=t.studentDetails)==null?void 0:i.section]})]}),a("span",{className:"px-2 py-0.5 sm:px-3 sm:py-1 rounded-full text-xs font-semibold uppercase tracking-wide flex items-center gap-0.5 sm:gap-1 flex-shrink-0 whitespace-nowrap ".concat(t.status==="dispatched"?"bg-purple-100 text-purple-700":t.status==="approved_by_hod"?"bg-blue-100 text-blue-700":t.status==="dispatch_requested"?"bg-yellow-100 text-yellow-700":"bg-gray-100 text-gray-700"),children:["ðŸ“¤ ",(t.status||"unknown").replace(/_/g," ")]})]}),a("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 sm:gap-6 text-xs sm:text-sm",children:[a("div",{children:[e("p",{className:"text-gray-500 mb-1 font-medium",children:"Department"}),e("p",{className:"font-medium text-gray-900",children:((o=t.studentDetails)==null?void 0:o.department)||"â€”"})]}),a("div",{children:[e("p",{className:"text-gray-500 mb-1 font-medium",children:"Result"}),e("p",{className:"font-bold ".concat(t.overallResult==="Pass"?"text-green-600":t.overallResult==="Fail"?"text-red-600":"text-gray-600"),children:t.overallResult||"â€”"})]}),a("div",{children:[e("p",{className:"text-gray-500 mb-1 font-medium",children:"Updated"}),e("p",{className:"font-medium text-gray-900",children:t.updatedAt?new Date(t.updatedAt).toLocaleDateString("en-IN"):"â€”"})]}),a("div",{children:[e("p",{className:"text-gray-500 mb-1 font-medium",children:"Parent Phone"}),e("p",{className:"font-medium text-gray-900 truncate",children:((x=t.studentDetails)==null?void 0:x.parentPhoneNumber)||"â€”"})]})]}),e("div",{className:"hidden sm:flex gap-3 mt-4 justify-end",children:a("a",{href:"/api/generate-pdf?marksheetId=".concat(t._id),target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-2 px-4 py-2 bg-blue-100 text-blue-700 rounded-lg font-semibold text-sm hover:bg-blue-200 transition-colors",children:[e("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"Download PDF"]})})]}),e("div",{className:"sm:hidden p-3 bg-gradient-to-r from-blue-50 to-indigo-50 border-t border-blue-100",children:a("p",{className:"text-xs text-center text-gray-600 flex items-center justify-center gap-2",children:[e("span",{children:"ðŸ‘ˆ"}),e("span",{className:"font-medium",children:"Swipe left to download"})]})})]})},t._id)})})]})]})})}export{S as default};
