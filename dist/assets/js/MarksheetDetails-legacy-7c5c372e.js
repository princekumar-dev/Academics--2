System.register(["./index-legacy-b6735175.js","./react-vendor-legacy-4587369d.js","./resultUtils-legacy-0d7791a3.js"],function(e,t){"use strict";var a,s,r,n,l,d,i,o,c,u;return{setters:[e=>{a=e.j,s=e.b,r=e.F,n=e.u,l=e.a},e=>{d=e.f,i=e.u,o=e.r},e=>{c=e.d,u=e.a}],execute:function(){function t({marksheet:e,onVerified:t}){const[d,i]=o.useState(!1),[c,u]=o.useState(""),[m,h]=o.useState(!1),[g]=o.useState(()=>{try{const e=localStorage.getItem("auth");return e?JSON.parse(e):null}catch{return null}});o.useEffect(()=>{h("verified_by_staff"===e?.status||"approved_by_hod"===e?.status||"dispatched"===e?.status)},[e]);const p=["approved_by_hod","rejected_by_hod","dispatched"],{showError:b}=n();return s(r,{children:[a("button",{disabled:d||m||p.includes(e?.status),onClick:async()=>{let a=g;try{const e=localStorage.getItem("auth");e&&(a=JSON.parse(e))}catch(s){console.error("Error refreshing user data:",s)}if(!a?.eSignature){const e=a?._id||a?.id||localStorage.getItem("userId");if(e)try{const t=await l.get(`/api/users?action=profile&userId=${e}`);t?.success&&t.user&&(a={...a,...t.user},localStorage.setItem("auth",JSON.stringify(a)))}catch(r){console.error("Error fetching user profile:",r)}}i(!0),u("");try{const r=a?.eSignature||null;if(!r){try{b("Signature Missing","Please add your signature in Settings before verifying this marksheet")}catch(s){}return void i(!1)}try{const a=await l.post("/api/marksheets?action=verify",r?{marksheetId:e._id,staffSignature:r}:{marksheetId:e._id});a&&a.success?(h(!0),t(a.marksheet)):u(a?.error||"Verification failed")}catch(s){u(s.message||"Verification failed")}}catch(s){u(s.message||"Unexpected error")}finally{i(!1)}},className:"px-5 py-2 rounded-lg transform transition-all duration-200 hover:-translate-y-0.5 hover:shadow-md w-full sm:w-auto "+(m||p.includes(e?.status)?"bg-green-200 text-green-900 cursor-not-allowed":d?"bg-green-200 text-green-900":"bg-green-600 text-white"),children:m?"Verified":d?"Verifying...":"Verify"}),c&&a("span",{className:"text-red-600 text-sm ml-2",children:c})]})}function m({id:e,form:t,onSaved:n}){const[d,i]=o.useState(!1),[c,u]=o.useState("");return s(r,{children:[a("button",{disabled:d,onClick:async()=>{i(!0),u("");try{try{const a=await l.put("/api/marksheets",{marksheetId:e,studentDetails:t.studentDetails,subjects:t.subjects,regenerateSignatures:!0});a&&a.success?n(a.marksheet):u(a?.error||"Save failed")}catch(a){u(a.message||"Save failed")}}catch(a){u(a.message||"Unexpected error")}finally{i(!1)}},className:"px-5 py-2 rounded-lg transform transition-all duration-200 hover:-translate-y-0.5 hover:shadow-md w-full sm:w-auto "+(d?"bg-blue-200 text-blue-900":"bg-blue-600 text-white"),children:d?"Saving...":"Save Changes"}),c&&a("span",{className:"text-red-600 text-sm ml-2",children:c})]})}function h({id:e,onRefreshed:t}){const[s,r]=o.useState(!1),{showSuccess:d,showError:i}=n();return a("button",{onClick:async()=>{r(!0);try{try{const a=await l.put("/api/marksheets",{marksheetId:e,regenerateSignatures:!0});a&&a.success?(d("Signatures Refreshed","Staff/HOD signatures were updated on this marksheet"),"function"==typeof t&&t(a.marksheet)):i("Refresh Failed",a?.error||"Could not refresh signatures")}catch(a){i("Refresh Failed",a.message||"Could not refresh signatures")}}catch(a){i("Refresh Failed",a.message||"Unexpected error")}finally{r(!1)}},disabled:s,className:"px-5 py-2 rounded-lg transform transition-all duration-200 hover:-translate-y-0.5 hover:shadow-md w-full sm:w-auto "+(s?"bg-gray-200 text-gray-800":"bg-indigo-600 text-white"),children:s?"Refreshing...":"Refresh Signatures"})}e("default",function(){const{id:e}=d(),n=i(),[g,p]=o.useState(null),[b,f]=o.useState(!0),[y,x]=o.useState(""),[N,v]=o.useState(!1),[w,k]=o.useState({studentDetails:{},subjects:[]}),[S]=o.useState(()=>{try{const e=localStorage.getItem("auth");return e?JSON.parse(e):null}catch{return null}});o.useEffect(()=>{(async()=>{if(!e||"undefined"===e||"null"===e)return x("Invalid marksheet id"),void f(!1);try{const t=await l.get(`/api/marksheets?marksheetId=${encodeURIComponent(e)}`);t&&t.success&&t.marksheet?(p(t.marksheet),t.marksheet&&k({studentDetails:{...t.marksheet.studentDetails||{}},subjects:Array.isArray(t.marksheet.subjects)?t.marksheet.subjects.map(e=>{const t=u(e);return{...e,result:"—"===t?"Pass":t}}):[]})):x(t?.error||"Failed to load marksheet")}catch(t){x(t.message||"Unexpected error")}finally{f(!1)}})()},[e]);const D=o.useMemo(()=>{const e={draft:{label:"Draft",className:"bg-gray-100 text-gray-800"},verified_by_staff:{label:"Verified by Staff",className:"bg-green-100 text-green-800"},dispatch_requested:{label:"Dispatch Requested",className:"bg-yellow-100 text-yellow-800"},approved_by_hod:{label:"Approved by HOD",className:"bg-blue-100 text-blue-800"},rejected_by_hod:{label:"Rejected by HOD",className:"bg-red-100 text-red-800"},dispatched:{label:"Dispatched",className:"bg-purple-100 text-purple-800"},unknown:{label:"Unknown",className:"bg-gray-200 text-gray-700"}};return e["rescheduled_by_hod"===g?.status?"dispatch_requested":g?.status||"unknown"]||e.unknown},[g]),_=o.useMemo(()=>{if(!g||!S||"staff"!==S.role)return!1;const e=g.staffId?._id||g.staffId,t=S._id||S.id;if(!e||!t)return!1;try{return String(e)===String(t)}catch{return!1}},[g,S]),j=o.useMemo(()=>{if(!g||!S||"hod"!==S.role)return!1;const e=g.hodId?._id||g.hodId,t=S._id||S.id;if(!e||!t)return!1;try{return String(e)===String(t)}catch{return!1}},[g,S]),R="staff"===S?.role&&_,C=o.useMemo(()=>c(g),[g]);return a("div",b?{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 flex items-center justify-center",children:s("div",{className:"glass-card p-8 rounded-3xl text-center",children:[a("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a("p",{className:"text-gray-600",children:"Loading marksheet..."})]})}:y||!g?{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 flex items-center justify-center",children:s("div",{className:"glass-card p-8 rounded-3xl text-center",children:[a("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Not Found"}),a("p",{className:"text-gray-600",children:y||"Marksheet not found"}),a("button",{onClick:()=>n(-1),className:"mt-6 px-5 py-2 bg-blue-600 text-white rounded-lg",children:"Go Back"})]})}:{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:a("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:s("div",{className:"max-w-4xl mx-auto",children:[s("div",{className:"text-center mb-12",children:[a("h1",{className:"text-4xl sm:text-5xl lg:text-6xl font-black text-gray-900 mb-4",children:"Marksheet Details"}),s("p",{className:"text-lg text-gray-600 max-w-3xl mx-auto",children:["View, verify, and manage individual student marksheet details.",a("br",{}),"Track pass/fail/absent outcomes, dispatch status, and update student information as needed."]})]}),s("div",{className:"glass-card p-8 rounded-3xl transform transition-all duration-200 hover:-translate-y-0.5 hover:shadow-md hover:border-gray-300",children:[s("div",{className:"flex items-center justify-between mb-6",children:[a("h2",{className:"text-3xl font-bold text-gray-900",children:g.studentDetails?.name}),a("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${D.className}`,children:D.label.toUpperCase()})]}),s("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[s("div",{className:"bg-white p-6 rounded-xl border border-gray-200 transform transition-all duration-200 hover:-translate-y-0.5 hover:shadow-md hover:border-gray-300",children:[a("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Student"}),N?s("div",{className:"space-y-3",children:[s("div",{children:[a("label",{className:"block text-sm text-gray-600 mb-1",children:"Name"}),a("input",{value:w.studentDetails.name||"",onChange:e=>k(t=>({...t,studentDetails:{...t.studentDetails,name:e.target.value}})),className:"w-full border rounded-lg px-3 py-2"})]}),s("div",{children:[a("label",{className:"block text-sm text-gray-600 mb-1",children:"Reg No"}),a("input",{value:w.studentDetails.regNumber||"",onChange:e=>k(t=>({...t,studentDetails:{...t.studentDetails,regNumber:e.target.value}})),className:"w-full border rounded-lg px-3 py-2"})]}),s("div",{className:"grid grid-cols-2 gap-3",children:[s("div",{children:[a("label",{className:"block text-sm text-gray-600 mb-1",children:"Year"}),a("input",{value:w.studentDetails.year||"",onChange:e=>k(t=>({...t,studentDetails:{...t.studentDetails,year:e.target.value}})),className:"w-full border rounded-lg px-3 py-2",placeholder:"e.g., II"})]}),s("div",{children:[a("label",{className:"block text-sm text-gray-600 mb-1",children:"Semester"}),a("input",{value:w.semester||w.studentDetails.semester||"",onChange:e=>k(t=>({...t,semester:e.target.value})),className:"w-full border rounded-lg px-3 py-2",placeholder:"e.g., 1"})]})]}),s("div",{children:[a("label",{className:"block text-sm text-gray-600 mb-1",children:"Department"}),a("input",{value:w.studentDetails.department||"",onChange:e=>k(t=>({...t,studentDetails:{...t.studentDetails,department:e.target.value}})),className:"w-full border rounded-lg px-3 py-2"})]}),s("div",{children:[a("label",{className:"block text-sm text-gray-600 mb-1",children:"Parent Phone"}),a("input",{value:w.studentDetails.parentPhoneNumber||"",onChange:e=>k(t=>({...t,studentDetails:{...t.studentDetails,parentPhoneNumber:e.target.value}})),className:"w-full border rounded-lg px-3 py-2"})]})]}):s(r,{children:[s("p",{className:"text-gray-700",children:[a("strong",{children:"Reg No:"})," ",g.studentDetails?.regNumber]}),s("p",{className:"text-gray-700",children:[a("strong",{children:"Year/Sem:"})," ",g.studentDetails?.year,"/",g.semester||g.studentDetails?.semester||"N/A"]}),s("p",{className:"text-gray-700",children:[a("strong",{children:"Department:"})," ",g.studentDetails?.department]}),s("p",{className:"text-gray-700",children:[a("strong",{children:"Parent:"})," ",g.studentDetails?.parentPhoneNumber]})]})]}),s("div",{className:"bg-white p-6 rounded-xl border border-gray-200 transform transition-all duration-200 hover:-translate-y-0.5 hover:shadow-md hover:border-gray-300",children:[a("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Summary"}),s("p",{className:"text-gray-700",children:[a("strong",{children:"Examination Name:"})," ",g.examinationName||"N/A"]}),s("p",{className:"text-gray-700",children:[a("strong",{children:"Examination Date:"})," ",g.examinationDate?new Date(g.examinationDate).toLocaleString("default",{month:"long",year:"numeric"}):"N/A"]}),s("p",{className:"text-gray-700",children:[a("strong",{children:"Overall Result:"})," ",C]}),s("p",{className:"text-gray-700",children:[a("strong",{children:"Staff:"})," ",g.staffName]}),g.hodName&&s("p",{className:"text-gray-700",children:[a("strong",{children:"HOD:"})," ",g.hodName]}),"approved_by_hod"===g.status&&g.dispatchRequest?.respondedAt&&s("p",{className:"text-gray-700",children:[a("strong",{children:"Approved On:"})," ",new Date(g.dispatchRequest.respondedAt).toLocaleString()]})]})]}),g.dispatchRequest?.hodResponse&&s("div",{className:"mt-6 bg-white p-6 rounded-xl border border-gray-200",children:[a("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Dispatch Notes"}),s("dl",{className:"space-y-2 text-gray-700",children:[g.dispatchRequest?.hodResponse&&s("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[a("dt",{className:"font-medium",children:"HOD Decision"}),a("dd",{className:"capitalize",children:g.dispatchRequest.hodResponse})]}),g.dispatchRequest?.hodComments&&s("div",{children:[a("dt",{className:"font-medium",children:"Comments"}),a("dd",{className:"text-gray-700 mt-1",children:g.dispatchRequest.hodComments})]})]})]}),s("div",{className:"mt-8 bg-white p-6 rounded-xl border border-gray-200 transform transition-all duration-200 hover:-translate-y-0.5 hover:shadow-md hover:border-gray-300",children:[a("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Subjects"}),a("div",N?{className:"space-y-3",children:w.subjects.map((e,t)=>s("div",{className:"grid grid-cols-3 gap-3 items-center",children:[a("input",{value:e.subjectName,onChange:e=>k(a=>{const s=[...a.subjects];return s[t]={...s[t],subjectName:e.target.value},{...a,subjects:s}}),className:"border rounded-lg px-3 py-2"}),a("input",{type:"number",value:e.marks,onChange:e=>k(a=>{const s=[...a.subjects];return s[t]={...s[t],marks:Number(e.target.value)},{...a,subjects:s}}),className:"border rounded-lg px-3 py-2"}),s("select",{value:e.result||"",onChange:e=>k(a=>{const s=[...a.subjects];return s[t]={...s[t],result:e.target.value},{...a,subjects:s}}),className:"border rounded-lg px-3 py-2",children:[a("option",{value:"",children:"Select Result"}),a("option",{value:"Pass",children:"Pass"}),a("option",{value:"Fail",children:"Fail"}),a("option",{value:"Absent",children:"Absent"})]})]},t))}:{className:"divide-y divide-gray-100",children:(g.subjects||[]).map((e,t)=>s("div",{className:"py-3 space-y-1 sm:space-y-0 sm:grid sm:grid-cols-2 sm:items-center",children:[a("span",{className:"text-gray-800 break-words min-w-0",children:e.subjectName}),s("div",{className:"flex items-center justify-between sm:justify-end gap-2 text-gray-700",children:[a("span",{className:"font-semibold",children:e.marks??"—"}),s("span",{className:"whitespace-nowrap",children:["Result: ",u(e)]})]})]},t))})]}),s("div",{className:"mt-8 flex flex-col sm:flex-row gap-3",children:[a("button",{onClick:()=>n(-1),className:"px-5 py-2 bg-gray-100 text-gray-800 rounded-lg transform transition-all duration-200 hover:-translate-y-0.5 hover:shadow-md w-full sm:w-auto",children:"Back"}),!N&&R&&s(r,{children:[a(t,{marksheet:g,onVerified:p}),a("button",{onClick:()=>v(!0),className:"px-5 py-2 bg-blue-600 text-white rounded-lg transform transition-all duration-200 hover:-translate-y-0.5 hover:shadow-md w-full sm:w-auto",children:"Edit & Regenerate"})]}),!N&&(R||j)&&s("div",{className:"flex gap-2 w-full sm:w-auto",children:[a(h,{id:g._id,onRefreshed:p}),a("button",{onClick:e=>{e.preventDefault();const t=Date.now(),a=window.location.origin,s=a?`${a}/api/generate-pdf?marksheetId=${g._id}&t=${t}`:`/api/generate-pdf?marksheetId=${g._id}&t=${t}`;window.open(s,"_blank")},className:"px-5 py-2 rounded-lg transform transition-all duration-200 hover:-translate-y-0.5 hover:shadow-md w-full sm:w-auto bg-yellow-600 text-white",children:"Download PDF"})]}),N&&R&&s(r,{children:[a("button",{onClick:()=>v(!1),className:"px-5 py-2 bg-gray-200 text-gray-800 rounded-lg transform transition-all duration-200 hover:-translate-y-0.5 hover:shadow-md w-full sm:w-auto",children:"Cancel"}),a(m,{id:g._id,form:w,onSaved:e=>{p(e),v(!1)}})]})]})]})]})})})})}}});
