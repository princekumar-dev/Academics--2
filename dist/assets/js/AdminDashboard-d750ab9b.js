import{c as D,u as q,a as R,j as e,b as t,F as J,C as G,f as B,h as V,g as _}from"./index-ba65f9b1.js";import{r as m,u as Y}from"./react-vendor-ad4d5528.js";import{C as T}from"./ConfirmDialog-600f2ec4.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],X=D("activity",K);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M13 2a9 9 0 0 1 9 9",key:"1itnx2"}],["path",{d:"M13 6a5 5 0 0 1 5 5",key:"11nki7"}],["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],ee=D("phone-call",Z);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],z=D("qr-code",te);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],$=D("refresh-cw",se);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],O=D("shield",ae);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],P=D("users",re);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],le=D("wifi-off",ne);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],ie=D("wifi",oe);function ce(){var H;const[i,u]=m.useState(null),[r,b]=m.useState(null),[h,p]=m.useState(!1),[g,M]=m.useState(null),[Q,f]=m.useState(!1),[w,c]=m.useState(null),{showSuccess:l,showError:d,showInfo:S}=q(),W="https://academics-5bf1.onrender.com",v="whatsapp_status_cache_v1",N=m.useRef(null),U=m.useRef(15e3);m.useEffect(()=>{try{const a=localStorage.getItem(v);if(a){const n=JSON.parse(a);n!=null&&n.status&&u(n.status),n!=null&&n.connectionStatus&&b(n.connectionStatus),s(),o()}else s(),o()}catch(a){s(),o()}return N.current&&clearInterval(N.current),N.current=setInterval(o,U.current),()=>{N.current&&clearInterval(N.current)}},[]);const s=async()=>{try{const a=await R.get("/api/whatsapp-dispatch?action=status",{cache:!0,ttl:3e4,timeout:15e3});if(!a)return;console.log("WhatsApp status data:",a),u(a);try{const n=localStorage.getItem(v),I=n?JSON.parse(n):{};localStorage.setItem(v,JSON.stringify({status:a,connectionStatus:I.connectionStatus||r||null,ts:Date.now()}))}catch(n){}}catch(a){console.warn("Failed to fetch WhatsApp status:",a.message||a)}},o=async()=>{try{const a=await R.get("/api/whatsapp-dispatch?action=connection-status",{cache:!0,ttl:15e3,timeout:6e4,retry:1,retryDelay:800});if(!a)return;console.log("Connection status data:",a),b(a);try{const n=localStorage.getItem(v),I=n?JSON.parse(n):{};localStorage.setItem(v,JSON.stringify({status:I.status||i||null,connectionStatus:a,ts:Date.now()}))}catch(n){}}catch(a){b({connected:!1,state:"error",error:(a==null?void 0:a.message)||"Network error"});try{U.current===15e3&&(U.current=3e4,N.current&&clearInterval(N.current),N.current=setInterval(o,U.current))}catch(n){}try{const n=localStorage.getItem(v),I=n?JSON.parse(n):{};localStorage.setItem(v,JSON.stringify({status:I.status||i||null,connectionStatus:{connected:!1,state:"error",error:(a==null?void 0:a.message)||"Network error"},ts:Date.now()}))}catch(n){}}},y=async()=>{p(!0);try{const a=await R.get("/api/whatsapp-dispatch?action=qrcode",{cache:!1,timeout:2e4});if(console.log("QR Code API response:",a),a.success){if(a.connected||a.state==="open"){S("Already Connected",a.message||'WhatsApp instance is already connected. Use "Disconnect" to link a different number.'),await o();return}a.qrcode?(console.log("QR Code data:",a.qrcode),M(a.qrcode||a),f(!0),l("QR Code ready","Scan the QR code with your WhatsApp app.")):d("No QR Code","No QR code was returned. The instance may need to be created first.")}else d("Failed to generate QR code",a.error||"Could not generate QR code. Please try again.")}catch(a){d("Failed to generate QR code",_(a,"Could not generate QR code. Please try again."))}finally{p(!1)}},x=async()=>{p(!0),await s(),await o(),p(!1)},j=async()=>{p(!0);try{console.log("Logging out instance...");const a=await R.post("".concat(W,"/api/whatsapp-dispatch?action=logout"),null,{timeout:1e4});console.log("Logout response:",a),a&&a.success?(l("Disconnected",a.message||'WhatsApp disconnected successfully. Use "Get QR Code" to connect a different number.'),setTimeout(async()=>{await s(),await o()},1e3)):d("Failed to disconnect",a&&(a.error||a.message)||"Could not disconnect. Please try again.")}catch(a){d("Failed to disconnect WhatsApp",_(a,"Could not disconnect. Please try again."))}finally{p(!1)}},k=async()=>{console.log("ðŸ—‘ï¸ performDeleteInstance called!"),p(!0);try{console.log("ðŸ—‘ï¸ Starting instance deletion...");try{const a=await R.del("".concat(W,"/api/whatsapp-dispatch?action=delete-instance"),{timeout:15e3});console.log("Delete instance result:",a),l("Instance Deleted",a.message||"WhatsApp instance has been deleted successfully"),u(n=>({...n,configured:!1})),b(null),console.log("â³ Waiting for backend cleanup..."),setTimeout(async()=>{console.log("ðŸ”„ Refreshing status..."),await s(),await o()},2e3)}catch(a){if(a&&a.status===404){const n=a.data||{};l("Instance Deleted",n.message||"WhatsApp instance has been deleted successfully"),u(I=>({...I,configured:!1})),b(null),setTimeout(async()=>{await s(),await o()},2e3)}else console.error("âŒ Delete instance error:",a),d("Failed to delete instance",_(a,"Could not delete instance. Please try again."))}}catch(a){d("Failed to delete instance",_(a,"Could not delete instance. Please try again."))}finally{p(!1)}},E=()=>{c({title:"Disconnect WhatsApp",message:"Disconnect the current WhatsApp number? You will need to scan a new QR code to reconnect.",onConfirm:j})},F=()=>{console.log("ðŸ—‘ï¸ handleDeleteInstance clicked!"),c({title:"Delete WhatsApp Instance",message:"This will delete the instance and all session data. You will need to create a new instance and scan a fresh QR code. Continue?",onConfirm:k})};if(h&&!i)return e("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-gray-200",children:t("div",{className:"animate-pulse",children:[e("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-4"}),e("div",{className:"h-20 bg-gray-200 rounded"})]})});if(!i)return null;const L=i.configured,A=(r==null?void 0:r.connected)===!0||(r==null?void 0:r.state)==="open"||!1,C=(r==null?void 0:r.state)||"unknown";return t(J,{children:[t("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 px-6 py-4 border-b border-gray-200",children:t("div",{className:"flex items-center justify-between",children:[t("div",{className:"flex items-center gap-3",children:[e("div",{className:"w-3 h-3 rounded-full ".concat(A?"bg-green-500 animate-pulse":"bg-gray-400")}),e("h3",{className:"text-lg font-semibold text-gray-900",children:"Evolution API Status"})]}),e("button",{onClick:()=>{s(),o()},disabled:h,className:"p-2 hover:bg-white/50 rounded-lg transition-colors disabled:opacity-50",title:"Refresh status",children:e($,{className:"w-4 h-4 text-gray-600 ".concat(h?"animate-spin":"")})})]})}),e("div",{className:"px-6 py-4 bg-gray-50 border-b border-gray-200",children:t("div",{className:"flex items-center justify-between",children:[t("div",{className:"flex items-center gap-3",children:[A?e(ie,{className:"w-5 h-5 text-green-600"}):e(le,{className:"w-5 h-5 text-gray-400"}),t("div",{className:"flex-1",children:[e("p",{className:"text-sm font-medium text-gray-900",children:"Connection Status"}),t("p",{className:"text-xs text-gray-600",children:[A?e("span",{className:"text-green-600 font-semibold",children:"â— Connected"}):e("span",{className:"text-gray-500",children:"â— Disconnected"}),C&&C!=="unknown"&&t("span",{className:"ml-2 text-gray-500",children:["(",C,")"]})]}),!A&&(r==null?void 0:r.error)&&t("p",{className:"text-xs text-red-500 mt-1",children:["Error: ",r.error]}),!A&&(r==null?void 0:r.state)==="not_configured"&&e("p",{className:"text-xs text-yellow-600 mt-1",children:"âš ï¸ Evolution API not configured in .env"}),!A&&((H=r==null?void 0:r.error)==null?void 0:H.includes("404"))&&e("p",{className:"text-xs text-yellow-600 mt-1",children:'âš ï¸ Instance not found - Click "Get QR Code" to create it'})]})]}),t("div",{className:"text-right",children:[e("p",{className:"text-xs text-gray-500",children:"Auto-refresh: 10s"}),r&&t("p",{className:"text-xs text-gray-400",children:["Last updated: ",new Date().toLocaleTimeString()]})]})]})}),t("div",{className:"p-6 space-y-4",children:[t("div",{className:"flex items-start gap-3 p-4 bg-gray-50 rounded-lg",children:[L?e(G,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}):e(B,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),t("div",{className:"flex-1",children:[t("div",{className:"flex items-center gap-2 mb-1",children:[e("span",{className:"font-medium text-gray-900",children:"Provider:"}),e("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Evolution API"})]}),e("p",{className:"text-sm text-gray-600",children:L?"âœ… Evolution API is configured and ready":"âŒ Evolution API is not configured"})]})]}),t("div",{className:"space-y-3",children:[i.configured!==void 0&&t("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[t("div",{className:"p-3 bg-blue-50 rounded-lg",children:[e("p",{className:"text-xs text-gray-600 mb-1",children:"Instance Name"}),e("p",{className:"text-sm font-medium text-gray-900",children:i.instance||"Not set"})]}),t("div",{className:"p-3 bg-blue-50 rounded-lg",children:[e("p",{className:"text-xs text-gray-600 mb-1",children:"Base URL"}),e("p",{className:"text-sm font-medium text-gray-900 truncate",children:i.baseUrl||"Not set"})]})]}),L&&t("div",{className:"space-y-2 pt-2",children:[t("div",{className:"flex gap-2",children:[t("button",{onClick:y,disabled:h,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e(z,{className:"w-4 h-4"}),e("span",{children:"Get QR Code"})]}),t("button",{onClick:x,disabled:h,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e($,{className:"w-4 h-4 ".concat(h?"animate-spin":"")}),e("span",{children:"Refresh Status"})]})]}),t("button",{onClick:E,disabled:h,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Disconnect current WhatsApp and connect a new number",children:[e("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),e("span",{children:"Disconnect & Change Number"})]}),t("button",{onClick:F,disabled:h,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete instance and all session data - fresh start",children:[e("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),e("span",{children:"Delete Instance"})]})]})]}),!L&&t("div",{className:"flex items-start gap-2 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[e(V,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),t("div",{className:"flex-1",children:[e("p",{className:"text-sm text-yellow-800 mb-1",children:"WhatsApp service is not configured. Please set up Evolution API to enable marksheet dispatch."}),e("a",{href:i.setupGuide||"#",className:"text-sm font-medium text-yellow-900 hover:text-yellow-700 underline",target:"_blank",rel:"noopener noreferrer",children:"View Setup Guide â†’"})]})]})]}),Q&&g&&e("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center min-h-screen p-3 sm:p-4",children:t("div",{className:"bg-white rounded-lg sm:rounded-xl shadow-2xl w-full max-w-sm sm:max-w-md p-4 sm:p-6 max-h-[90vh] overflow-y-auto",children:[t("div",{className:"flex items-center justify-between mb-4",children:[e("h3",{className:"text-base sm:text-lg font-semibold text-gray-900",children:"Scan QR Code"}),e("button",{onClick:()=>f(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors flex-shrink-0",children:e("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e("div",{className:"bg-white p-3 sm:p-4 rounded-lg border-2 border-gray-200 flex justify-center",children:g.base64?e("img",{src:g.base64&&g.base64.startsWith("data:image")?g.base64:"data:image/png;base64,".concat(g.base64),alt:"WhatsApp QR Code",className:"w-full max-w-xs sm:max-w-sm h-auto"}):g.qrcode?e("div",{className:"bg-gray-100 p-2 sm:p-4 rounded text-center overflow-x-auto",children:e("pre",{className:"text-xs overflow-auto whitespace-pre-wrap break-words",children:g.qrcode})}):e("p",{className:"text-center text-gray-500 text-sm",children:"QR code not available"})}),t("div",{className:"mt-4 p-3 sm:p-4 bg-blue-50 rounded-lg",children:[e("p",{className:"text-xs sm:text-sm text-gray-700 mb-2 font-semibold",children:"Steps to connect:"}),t("ol",{className:"text-xs sm:text-sm text-gray-600 space-y-1 list-decimal list-inside",children:[e("li",{children:"Open WhatsApp on your phone"}),e("li",{children:"Go to Settings â†’ Linked Devices"}),e("li",{children:'Tap "Link a Device"'}),e("li",{children:"Scan this QR code"})]})]}),e("button",{onClick:()=>f(!1),className:"mt-4 w-full px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors text-sm sm:text-base",children:"Close"})]})})]}),w&&e(T,{open:!0,title:w.title,description:w.message,confirmLabel:"Delete",cancelLabel:"Cancel",onConfirm:()=>{console.log("âœ… Confirm dialog confirmed, executing callback..."),w.onConfirm(),c(null)},onCancel:()=>{console.log("âŒ Confirm dialog cancelled"),c(null)}})]})}function de(){const{showSuccess:i,showError:u,showInfo:r}=q(),[b,h]=m.useState(!1);async function p(){if(!("serviceWorker"in navigator)){u("Service Worker","Service workers are not supported in this browser");return}h(!0);try{const l=await navigator.serviceWorker.getRegistrations();await Promise.all(l.map(d=>d.unregister().catch(()=>!1))),i("Service Workers","All service workers unregistered"),f()}catch(l){u("Service Workers",String(l))}finally{h(!1)}}async function g(){if(!("caches"in window)){u("Cache","CacheStorage not supported");return}h(!0);try{const l=await caches.keys();await Promise.all(l.map(d=>caches.delete(d).catch(()=>!1))),i("Caches","All Cache Storage entries removed"),f()}catch(l){u("Caches",String(l))}finally{h(!1)}}function M(){try{localStorage.removeItem("whatsapp_status_cache_v1"),localStorage.removeItem("auth"),localStorage.removeItem("userEmail"),i("Local Storage","Selected localStorage keys cleared");try{localStorage.setItem("msec:reload_signal",Date.now())}catch(l){}f()}catch(l){u("Local Storage",String(l))}}function Q(){try{r("Reload","Performing hard reload of this page"),window.location.reload(!0),f()}catch(l){u("Reload",String(l))}}async function f(){try{if(!("serviceWorker"in navigator))return;const l=await navigator.serviceWorker.getRegistrations();for(const d of l)try{const S=d.active||d.waiting||d.installing;S&&S.postMessage&&S.postMessage({type:"FORCE_RELOAD"})}catch(S){}}catch(l){}}const[w,c]=m.useState(null);return t("div",{className:"mt-4 bg-white p-3 rounded-md border border-gray-200",children:[e("h4",{className:"text-sm font-semibold text-gray-800 mb-2",children:"Service Worker & Cache Controls"}),e("p",{className:"text-xs text-gray-600 mb-3",children:"Use these controls when deploying to production to ensure clients pick up the latest assets."}),t("div",{className:"flex flex-wrap gap-2",children:[e("button",{onClick:()=>c({title:"Unregister service workers?",message:"This will unregister all service workers for this origin. Clients may lose offline support until you re-register the worker.",onConfirm:p}),disabled:b,className:"px-3 py-1 text-xs bg-red-600 text-white rounded-md",children:"Unregister SWs"}),e("button",{onClick:()=>c({title:"Clear CacheStorage?",message:"This will delete all CacheStorage entries for this origin. Offline assets and cached responses will be removed.",onConfirm:g}),disabled:b,className:"px-3 py-1 text-xs bg-orange-600 text-white rounded-md",children:"Clear CacheStorage"}),e("button",{onClick:()=>c({title:"Clear localStorage keys?",message:"This will clear selected application localStorage keys (auth, cached status). You will be logged out if auth is removed.",onConfirm:M}),className:"px-3 py-1 text-xs bg-yellow-600 text-white rounded-md",children:"Clear localStorage"}),e("button",{onClick:()=>c({title:"Hard reload page?",message:"This will force a full reload of this page. Unsaved state may be lost.",onConfirm:Q}),className:"px-3 py-1 text-xs bg-gray-600 text-white rounded-md",children:"Hard Reload"})]}),w&&e(T,{open:!0,title:w.title,description:w.message,confirmLabel:"Proceed",cancelLabel:"Cancel",onConfirm:()=>{w.onConfirm(),c(null)},onCancel:()=>c(null)})]})}function ge(){const i=Y(),{showSuccess:u,showError:r,showWarning:b,showInfo:h}=q(),[p,g]=m.useState(!1),[M,Q]=m.useState([]),[f,w]=m.useState({totalUsers:0,totalStaff:0,totalHODs:0,totalAdmins:0});m.useState(!1),m.useState(null);const[c,l]=m.useState(null),d=(s={})=>s.name||s.email||"Unknown User",S=(s={})=>(s.name||s.email||"U").charAt(0).toUpperCase();m.useEffect(()=>{const s=localStorage.getItem("auth");if(!s){i("/login");return}if(JSON.parse(s).role!=="admin"){b("Access Denied","Admin only area"),i("/");return}W()},[i,b]);const W=async()=>{var s,o,y,x;g(!0);try{const j=JSON.parse(localStorage.getItem("auth")||"{}"),k=await R.get("/api/users?action=list&userId=".concat(j.id),{headers:{"Content-Type":"application/json"}});if(k.success){Q(k.users||[]);const E=((s=k.users)==null?void 0:s.length)||0,F=((o=k.users)==null?void 0:o.filter(C=>C.role==="staff").length)||0,L=((y=k.users)==null?void 0:y.filter(C=>C.role==="hod").length)||0,A=((x=k.users)==null?void 0:x.filter(C=>C.role==="admin").length)||0;w({totalUsers:E,totalStaff:F,totalHODs:L,totalAdmins:A})}else r("Failed to Load Users",k.error||"Unable to fetch users")}catch(j){console.error("Failed to fetch users:",j),r("Error","Failed to fetch users. Please try again.")}finally{g(!1)}},v=async(s,o)=>{try{const y=JSON.parse(localStorage.getItem("auth")||"{}"),x=await R.del("/api/users?action=delete&id=".concat(s,"&userId=").concat(y.id));x&&x.success?(u("Success","User deleted successfully"),W()):r("Failed to Delete User",(x==null?void 0:x.error)||"Unable to delete user")}catch(y){console.error("Failed to delete user:",y),r("Error","Failed to delete user. Please try again.")}},N=s=>{l(s)},U=async()=>{c&&(await v(c._id||c.id,c.email),l(null))};return t(J,{children:[e("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 no-mobile-anim",children:e("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8 pb-20 md:pb-0",children:t("div",{className:"max-w-7xl mx-auto",children:[e("div",{className:"mb-8",children:t("div",{className:"flex items-center gap-3 sm:gap-4 mb-6",children:[e("div",{className:"p-2 sm:p-3 bg-gradient-to-r from-blue-600 to-blue-700 rounded-lg",children:e(O,{className:"w-6 h-6 sm:w-8 sm:h-8 text-white"})}),t("div",{children:[e("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900",children:"Admin Dashboard"}),e("p",{className:"text-sm sm:text-base text-gray-600 mt-1",children:"System Administration & Management"})]})]})}),t("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 md:gap-6",children:[t("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl shadow-md hover:shadow-lg transition-shadow border border-blue-200 overflow-hidden",children:[e("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 px-4 sm:px-5 py-3 sm:py-4",children:t("div",{className:"flex items-center justify-between",children:[t("div",{children:[e("p",{className:"text-blue-100 text-xs sm:text-sm font-semibold uppercase tracking-wider",children:"Total Users"}),e("p",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-white mt-2",children:f.totalUsers})]}),e(P,{className:"w-10 h-10 sm:w-12 sm:h-12 text-blue-200 opacity-80"})]})}),e("div",{className:"px-4 sm:px-5 py-2 sm:py-3 bg-blue-50 text-xs text-blue-600 font-medium",children:"All system users"})]}),t("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-xl shadow-md hover:shadow-lg transition-shadow border border-green-200 overflow-hidden",children:[e("div",{className:"bg-gradient-to-r from-green-500 to-green-600 px-4 sm:px-5 py-3 sm:py-4",children:t("div",{className:"flex items-center justify-between",children:[t("div",{children:[e("p",{className:"text-green-100 text-xs sm:text-sm font-semibold uppercase tracking-wider",children:"Staff Members"}),e("p",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-white mt-2",children:f.totalStaff})]}),e(P,{className:"w-10 h-10 sm:w-12 sm:h-12 text-green-200 opacity-80"})]})}),e("div",{className:"px-4 sm:px-5 py-2 sm:py-3 bg-green-50 text-xs text-green-600 font-medium",children:"Active staff accounts"})]}),t("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl shadow-md hover:shadow-lg transition-shadow border border-purple-200 overflow-hidden",children:[e("div",{className:"bg-gradient-to-r from-purple-500 to-purple-600 px-4 sm:px-5 py-3 sm:py-4",children:t("div",{className:"flex items-center justify-between",children:[t("div",{children:[e("p",{className:"text-purple-100 text-xs sm:text-sm font-semibold uppercase tracking-wider",children:"HODs"}),e("p",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-white mt-2",children:f.totalHODs})]}),e(O,{className:"w-10 h-10 sm:w-12 sm:h-12 text-purple-200 opacity-80"})]})}),e("div",{className:"px-4 sm:px-5 py-2 sm:py-3 bg-purple-50 text-xs text-purple-600 font-medium",children:"Department heads"})]}),t("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl shadow-md hover:shadow-lg transition-shadow border border-orange-200 overflow-hidden",children:[e("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 px-4 sm:px-5 py-3 sm:py-4",children:t("div",{className:"flex items-center justify-between",children:[t("div",{children:[e("p",{className:"text-orange-100 text-xs sm:text-sm font-semibold uppercase tracking-wider",children:"Admins"}),e("p",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-white mt-2",children:f.totalAdmins})]}),e(O,{className:"w-10 h-10 sm:w-12 sm:h-12 text-orange-200 opacity-80"})]})}),e("div",{className:"px-4 sm:px-5 py-2 sm:py-3 bg-orange-50 text-xs text-orange-600 font-medium",children:"System administrators"})]})]}),t("div",{className:"bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden",children:[e("div",{className:"bg-gradient-to-r from-green-50 to-green-100 px-4 sm:px-6 py-4 sm:py-5 border-b border-gray-200",children:t("div",{className:"flex items-center gap-2 sm:gap-3",children:[e(ee,{className:"w-5 h-5 sm:w-6 sm:h-6 text-green-600"}),e("h2",{className:"text-base sm:text-lg md:text-xl font-bold text-gray-900",children:"WhatsApp Management"})]})}),e("div",{className:"p-4 sm:p-5 md:p-6",children:e(ce,{})})]}),t("div",{className:"bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden",children:[e("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 px-4 sm:px-6 py-4 sm:py-5 border-b border-gray-200",children:t("div",{className:"flex items-center justify-between gap-2 sm:gap-4",children:[t("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0",children:[e(P,{className:"w-5 h-5 sm:w-6 sm:h-6 text-blue-600 flex-shrink-0"}),e("h2",{className:"text-base sm:text-lg md:text-xl font-bold text-gray-900 truncate",children:"User Management"})]}),t("button",{onClick:W,disabled:p,className:"flex items-center justify-center gap-2 px-2 py-1 sm:px-4 sm:py-2 bg-blue-600 text-white text-[11px] sm:text-sm font-medium rounded-md sm:rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0",title:p?"Refreshing...":"Refresh users",children:[e($,{className:"w-4 h-4 flex-shrink-0 ".concat(p?"animate-spin":"")}),e("span",{className:"hidden sm:inline",children:"Refresh"})]})]})}),e("div",{className:"overflow-x-auto",children:t("table",{className:"w-full",children:[e("thead",{className:"bg-gray-50 border-b border-gray-200 sticky top-0",children:t("tr",{children:[e("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider",children:"Name"}),e("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider hidden sm:table-cell",children:"Email"}),e("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider",children:"Role"}),e("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider hidden md:table-cell",children:"Dept"}),e("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider hidden lg:table-cell",children:"Phone"}),e("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider",children:"Action"})]})}),e("tbody",{className:"divide-y divide-gray-200",children:p?e("tr",{children:e("td",{colSpan:"6",className:"px-3 sm:px-4 md:px-6 py-6 sm:py-8 text-center",children:t("div",{className:"flex items-center justify-center gap-2",children:[e($,{className:"w-4 h-4 sm:w-5 sm:h-5 animate-spin text-blue-600"}),e("span",{className:"text-xs sm:text-sm text-gray-600",children:"Loading users..."})]})})},"loading"):M.length===0?e("tr",{children:e("td",{colSpan:"6",className:"px-3 sm:px-4 md:px-6 py-6 sm:py-8 text-center text-xs sm:text-sm text-gray-500",children:"No users found"})},"empty"):M.map((s,o)=>t("tr",{className:"hover:bg-blue-50 transition-colors",children:[e("td",{className:"px-3 sm:px-4 md:px-6 py-3 sm:py-4 whitespace-nowrap",children:t("div",{className:"flex items-center gap-2 sm:gap-3",children:[e("div",{className:"flex-shrink-0 h-8 w-8 sm:h-9 sm:w-9 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-white font-semibold text-xs sm:text-sm",children:S(s)}),e("div",{className:"text-xs sm:text-sm font-semibold text-gray-900 truncate max-w-[120px] sm:max-w-none",children:d(s)})]})}),e("td",{className:"px-3 sm:px-4 md:px-6 py-3 sm:py-4 hidden sm:table-cell",children:e("div",{className:"text-xs text-gray-700 truncate",children:s.email})}),e("td",{className:"px-3 sm:px-4 md:px-6 py-3 sm:py-4 whitespace-nowrap",children:e("span",{className:"inline-flex px-2 py-1 text-xs font-bold rounded-full ".concat(s.role==="admin"?"bg-red-100 text-red-700":s.role==="hod"?"bg-purple-100 text-purple-700":"bg-green-100 text-green-700"),children:s.role.charAt(0).toUpperCase()+s.role.slice(1)})}),e("td",{className:"px-3 sm:px-4 md:px-6 py-3 sm:py-4 hidden md:table-cell text-xs text-gray-700 truncate",children:s.department||"â€”"}),e("td",{className:"px-3 sm:px-4 md:px-6 py-3 sm:py-4 hidden lg:table-cell text-xs text-gray-700",children:s.phoneNumber||"â€”"}),e("td",{className:"px-3 sm:px-4 md:px-6 py-3 sm:py-4 whitespace-nowrap text-xs font-medium",children:s.role!=="admin"?e("button",{onClick:()=>N(s),className:"text-red-600 hover:text-red-900 hover:bg-red-50 px-2 py-1 rounded transition-colors",children:"Delete"}):e("span",{className:"text-gray-400 italic",children:"Admin"})})]},s._id||s.id||"user-".concat(o)))})]})})]}),t("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl p-4 sm:p-6 md:p-8 shadow-sm",children:[e("h3",{className:"text-base sm:text-lg font-bold text-blue-900 mb-4 sm:mb-6",children:"Quick Actions"}),t("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:[t("button",{onClick:()=>i("/signup"),className:"flex items-center justify-center gap-2 sm:gap-3 px-3 py-2 sm:px-4 sm:py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-md sm:rounded-lg hover:shadow-lg transition-all transform hover:scale-105 text-xs sm:text-sm font-semibold",children:[e(P,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e("span",{children:"Create User"})]}),t("button",{onClick:async()=>{g(!0);try{const s=await R.get("/api/whatsapp-dispatch?action=qrcode",{timeout:2e4});if(!s)throw new Error("No response from server");if(s.success&&(s.connected||s.state==="open")){h("Already Connected",s.message||"WhatsApp instance is already connected."),setTimeout(()=>window.location.reload(),400);return}if(s.success&&(s.base64||s.qrcode)){const o=window.open("","_blank");if(!o){r("Popup Blocked","Please allow popups to view the QR code");return}let y="";if(s.base64){const x=s.base64.startsWith("data:")?s.base64:"data:image/png;base64,".concat(s.base64);y='<img src="'.concat(x,'" alt="WhatsApp QR" style="max-width:100%;height:auto;display:block;margin:0 auto;"/>')}else if(s.qrcode){const x=String(s.qrcode).replace(/</g,"&lt;");y='<pre style="white-space:pre-wrap;word-break:break-word">'.concat(x,"</pre>")}o.document.write('<!doctype html><html><head><meta charset="utf-8"><title>WhatsApp QR</title></head><body style="font-family:system-ui, -apple-system, Segoe UI, Roboto, sans-serif;display:flex;align-items:center;justify-content:center;height:100vh;padding:20px">'.concat(y,"</body></html>")),o.document.close(),u("QR Ready","QR code opened in a new tab");return}r("Failed to generate QR",s.error||"Unknown error")}catch(s){console.error("Generate QR error:",s),r("Failed to generate QR",_(s,"Could not generate QR code. Please try again."))}finally{g(!1)}},className:"flex items-center justify-center gap-2 sm:gap-3 px-3 py-2 sm:px-4 sm:py-3 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-md sm:rounded-lg hover:shadow-lg transition-all transform hover:scale-105 text-xs sm:text-sm font-semibold",children:[e(z,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e("span",{children:"Generate QR"})]}),t("button",{onClick:()=>i("/"),className:"flex items-center justify-center gap-2 sm:gap-3 px-3 py-2 sm:px-4 sm:py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-md sm:rounded-lg hover:shadow-lg transition-all transform hover:scale-105 text-xs sm:text-sm font-semibold",children:[e(X,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e("span",{children:"Home"})]})]}),e(de,{})]})]})})}),e(T,{open:!!c,title:"Delete user?",description:c?"This will remove ".concat(d(c),". This action cannot be undone."):"",confirmLabel:"Delete",cancelLabel:"Cancel",onConfirm:U,onCancel:()=>l(null)})]})}export{ge as default};
