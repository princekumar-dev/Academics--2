System.register(["./index-legacy-9eeb83db.js","./react-vendor-legacy-4587369d.js","./ConfirmDialog-legacy-5891d735.js"],function(e,t){"use strict";var s,a,r,l,n,o,i,c,d,m,h,p;return{setters:[e=>{s=e.c,a=e.u,r=e.a,l=e.j,n=e.b,o=e.F,i=e.C,c=e.f,d=e.g},e=>{m=e.r,h=e.u},e=>{p=e.C}],execute:function(){e("default",function(){const e=h(),{showSuccess:s,showError:i,showWarning:c}=a(),[d,b]=m.useState(!1),[w,k]=m.useState([]),[S,C]=m.useState({totalUsers:0,totalStaff:0,totalHODs:0,totalAdmins:0});m.useState(!1),m.useState(null);const[A,I]=m.useState(null),M=(e={})=>e.name||e.email||"Unknown User",D=(e={})=>(e.name||e.email||"U").charAt(0).toUpperCase();m.useEffect(()=>{const t=localStorage.getItem("auth");if(t)return"admin"!==JSON.parse(t).role?(c("Access Denied","Admin only area"),void e("/")):void R();e("/login")},[e,c]);const R=async()=>{b(!0);try{const e=JSON.parse(localStorage.getItem("auth")||"{}"),t=await r.get(`/api/users?action=list&userId=${e.id}`,{headers:{"Content-Type":"application/json"}});if(t.success){k(t.users||[]);const e=t.users?.length||0,s=t.users?.filter(e=>"staff"===e.role).length||0,a=t.users?.filter(e=>"hod"===e.role).length||0,r=t.users?.filter(e=>"admin"===e.role).length||0;C({totalUsers:e,totalStaff:s,totalHODs:a,totalAdmins:r})}else i("Failed to Load Users",t.error||"Unable to fetch users")}catch(e){console.error("Failed to fetch users:",e),i("Error","Failed to fetch users. Please try again.")}finally{b(!1)}};return n(o,{children:[l("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 no-mobile-anim",children:l("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8 pb-20 md:pb-0",children:n("div",{className:"max-w-7xl mx-auto",children:[l("div",{className:"mb-8",children:n("div",{className:"flex items-center gap-3 sm:gap-4 mb-6",children:[l("div",{className:"p-2 sm:p-3 bg-gradient-to-r from-blue-600 to-blue-700 rounded-lg",children:l(y,{className:"w-6 h-6 sm:w-8 sm:h-8 text-white"})}),n("div",{children:[l("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900",children:"Admin Dashboard"}),l("p",{className:"text-sm sm:text-base text-gray-600 mt-1",children:"System Administration & Management"})]})]})}),n("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 md:gap-6",children:[n("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl shadow-md hover:shadow-lg transition-shadow border border-blue-200 overflow-hidden",children:[l("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 px-4 sm:px-5 py-3 sm:py-4",children:n("div",{className:"flex items-center justify-between",children:[n("div",{children:[l("p",{className:"text-blue-100 text-xs sm:text-sm font-semibold uppercase tracking-wider",children:"Total Users"}),l("p",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-white mt-2",children:S.totalUsers})]}),l(f,{className:"w-10 h-10 sm:w-12 sm:h-12 text-blue-200 opacity-80"})]})}),l("div",{className:"px-4 sm:px-5 py-2 sm:py-3 bg-blue-50 text-xs text-blue-600 font-medium",children:"All system users"})]}),n("div",{className:"bg-gradient-to-br from-green-50 to-green-100 rounded-xl shadow-md hover:shadow-lg transition-shadow border border-green-200 overflow-hidden",children:[l("div",{className:"bg-gradient-to-r from-green-500 to-green-600 px-4 sm:px-5 py-3 sm:py-4",children:n("div",{className:"flex items-center justify-between",children:[n("div",{children:[l("p",{className:"text-green-100 text-xs sm:text-sm font-semibold uppercase tracking-wider",children:"Staff Members"}),l("p",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-white mt-2",children:S.totalStaff})]}),l(f,{className:"w-10 h-10 sm:w-12 sm:h-12 text-green-200 opacity-80"})]})}),l("div",{className:"px-4 sm:px-5 py-2 sm:py-3 bg-green-50 text-xs text-green-600 font-medium",children:"Active staff accounts"})]}),n("div",{className:"bg-gradient-to-br from-purple-50 to-purple-100 rounded-xl shadow-md hover:shadow-lg transition-shadow border border-purple-200 overflow-hidden",children:[l("div",{className:"bg-gradient-to-r from-purple-500 to-purple-600 px-4 sm:px-5 py-3 sm:py-4",children:n("div",{className:"flex items-center justify-between",children:[n("div",{children:[l("p",{className:"text-purple-100 text-xs sm:text-sm font-semibold uppercase tracking-wider",children:"HODs"}),l("p",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-white mt-2",children:S.totalHODs})]}),l(y,{className:"w-10 h-10 sm:w-12 sm:h-12 text-purple-200 opacity-80"})]})}),l("div",{className:"px-4 sm:px-5 py-2 sm:py-3 bg-purple-50 text-xs text-purple-600 font-medium",children:"Department heads"})]}),n("div",{className:"bg-gradient-to-br from-orange-50 to-orange-100 rounded-xl shadow-md hover:shadow-lg transition-shadow border border-orange-200 overflow-hidden",children:[l("div",{className:"bg-gradient-to-r from-orange-500 to-orange-600 px-4 sm:px-5 py-3 sm:py-4",children:n("div",{className:"flex items-center justify-between",children:[n("div",{children:[l("p",{className:"text-orange-100 text-xs sm:text-sm font-semibold uppercase tracking-wider",children:"Admins"}),l("p",{className:"text-2xl sm:text-3xl lg:text-4xl font-bold text-white mt-2",children:S.totalAdmins})]}),l(y,{className:"w-10 h-10 sm:w-12 sm:h-12 text-orange-200 opacity-80"})]})}),l("div",{className:"px-4 sm:px-5 py-2 sm:py-3 bg-orange-50 text-xs text-orange-600 font-medium",children:"System administrators"})]})]}),n("div",{className:"bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden",children:[l("div",{className:"bg-gradient-to-r from-green-50 to-green-100 px-4 sm:px-6 py-4 sm:py-5 border-b border-gray-200",children:n("div",{className:"flex items-center gap-2 sm:gap-3",children:[l(g,{className:"w-5 h-5 sm:w-6 sm:h-6 text-green-600"}),l("h2",{className:"text-base sm:text-lg md:text-xl font-bold text-gray-900",children:"WhatsApp Management"})]})}),l("div",{className:"p-4 sm:p-5 md:p-6",children:l(N,{})})]}),n("div",{className:"bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden",children:[l("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 px-4 sm:px-6 py-4 sm:py-5 border-b border-gray-200",children:n("div",{className:"flex items-center justify-between gap-2 sm:gap-4",children:[n("div",{className:"flex items-center gap-2 sm:gap-3 min-w-0",children:[l(f,{className:"w-5 h-5 sm:w-6 sm:h-6 text-blue-600 flex-shrink-0"}),l("h2",{className:"text-base sm:text-lg md:text-xl font-bold text-gray-900 truncate",children:"User Management"})]}),n("button",{onClick:R,disabled:d,className:"flex items-center justify-center gap-2 px-2 py-1 sm:px-4 sm:py-2 bg-blue-600 text-white text-[11px] sm:text-sm font-medium rounded-md sm:rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0",title:d?"Refreshing...":"Refresh users",children:[l(u,{className:"w-4 h-4 flex-shrink-0 "+(d?"animate-spin":"")}),l("span",{className:"hidden sm:inline",children:"Refresh"})]})]})}),l("div",{className:"overflow-x-auto",children:n("table",{className:"w-full",children:[l("thead",{className:"bg-gray-50 border-b border-gray-200 sticky top-0",children:n("tr",{children:[l("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider",children:"Name"}),l("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider hidden sm:table-cell",children:"Email"}),l("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider",children:"Role"}),l("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider hidden md:table-cell",children:"Dept"}),l("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider hidden lg:table-cell",children:"Phone"}),l("th",{className:"px-3 sm:px-4 md:px-6 py-3 text-left text-xs font-bold text-gray-600 uppercase tracking-wider",children:"Action"})]})}),l("tbody",{className:"divide-y divide-gray-200",children:d?l("tr",{children:l("td",{colSpan:"6",className:"px-3 sm:px-4 md:px-6 py-6 sm:py-8 text-center",children:n("div",{className:"flex items-center justify-center gap-2",children:[l(u,{className:"w-4 h-4 sm:w-5 sm:h-5 animate-spin text-blue-600"}),l("span",{className:"text-xs sm:text-sm text-gray-600",children:"Loading users..."})]})})},"loading"):0===w.length?l("tr",{children:l("td",{colSpan:"6",className:"px-3 sm:px-4 md:px-6 py-6 sm:py-8 text-center text-xs sm:text-sm text-gray-500",children:"No users found"})},"empty"):w.map((e,t)=>n("tr",{className:"hover:bg-blue-50 transition-colors",children:[l("td",{className:"px-3 sm:px-4 md:px-6 py-3 sm:py-4 whitespace-nowrap",children:n("div",{className:"flex items-center gap-2 sm:gap-3",children:[l("div",{className:"flex-shrink-0 h-8 w-8 sm:h-9 sm:w-9 rounded-full bg-gradient-to-br from-blue-400 to-blue-600 flex items-center justify-center text-white font-semibold text-xs sm:text-sm",children:D(e)}),l("div",{className:"text-xs sm:text-sm font-semibold text-gray-900 truncate max-w-[120px] sm:max-w-none",children:M(e)})]})}),l("td",{className:"px-3 sm:px-4 md:px-6 py-3 sm:py-4 hidden sm:table-cell",children:l("div",{className:"text-xs text-gray-700 truncate",children:e.email})}),l("td",{className:"px-3 sm:px-4 md:px-6 py-3 sm:py-4 whitespace-nowrap",children:l("span",{className:"inline-flex px-2 py-1 text-xs font-bold rounded-full "+("admin"===e.role?"bg-red-100 text-red-700":"hod"===e.role?"bg-purple-100 text-purple-700":"bg-green-100 text-green-700"),children:e.role.charAt(0).toUpperCase()+e.role.slice(1)})}),l("td",{className:"px-3 sm:px-4 md:px-6 py-3 sm:py-4 hidden md:table-cell text-xs text-gray-700 truncate",children:e.department||"â€”"}),l("td",{className:"px-3 sm:px-4 md:px-6 py-3 sm:py-4 hidden lg:table-cell text-xs text-gray-700",children:e.phoneNumber||"â€”"}),l("td",{className:"px-3 sm:px-4 md:px-6 py-3 sm:py-4 whitespace-nowrap text-xs font-medium",children:"admin"!==e.role?l("button",{onClick:()=>(e=>{I(e)})(e),className:"text-red-600 hover:text-red-900 hover:bg-red-50 px-2 py-1 rounded transition-colors",children:"Delete"}):l("span",{className:"text-gray-400 italic",children:"Admin"})})]},e._id||e.id||`user-${t}`))})]})})]}),n("div",{className:"bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl p-4 sm:p-6 md:p-8 shadow-sm",children:[l("h3",{className:"text-base sm:text-lg font-bold text-blue-900 mb-4 sm:mb-6",children:"Quick Actions"}),n("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4",children:[n("button",{onClick:()=>e("/signup"),className:"flex items-center justify-center gap-2 sm:gap-3 px-3 py-2 sm:px-4 sm:py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-md sm:rounded-lg hover:shadow-lg transition-all transform hover:scale-105 text-xs sm:text-sm font-semibold",children:[l(f,{className:"w-4 h-4 sm:w-5 sm:h-5"}),l("span",{children:"Create User"})]}),n("button",{onClick:()=>{let e={VITE_API_URL:"https://academics-5bf1.onrender.com",VITE_APP_NAME:"MSEC Academics",VITE_APP_VERSION:"1.0.0",VITE_USER_NODE_ENV:"production",BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1,LEGACY:!0}?.VITE_PUBLIC_BASE_URL||"https://academics-5bf1.onrender.com";e.endsWith("/")&&(e=e.slice(0,-1)),window.open(`${e}/api/whatsapp-dispatch?action=qrcode`,"_blank")},className:"flex items-center justify-center gap-2 sm:gap-3 px-3 py-2 sm:px-4 sm:py-3 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-md sm:rounded-lg hover:shadow-lg transition-all transform hover:scale-105 text-xs sm:text-sm font-semibold",children:[l(x,{className:"w-4 h-4 sm:w-5 sm:h-5"}),l("span",{children:"Generate QR"})]}),n("button",{onClick:()=>e("/"),className:"flex items-center justify-center gap-2 sm:gap-3 px-3 py-2 sm:px-4 sm:py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-md sm:rounded-lg hover:shadow-lg transition-all transform hover:scale-105 text-xs sm:text-sm font-semibold",children:[l(t,{className:"w-4 h-4 sm:w-5 sm:h-5"}),l("span",{children:"Home"})]})]}),l(v,{})]})]})})}),l(p,{open:!!A,title:"Delete user?",description:A?`This will remove ${M(A)}. This action cannot be undone.`:"",confirmLabel:"Delete",cancelLabel:"Cancel",onConfirm:async()=>{A&&(await(async e=>{try{const t=JSON.parse(localStorage.getItem("auth")||"{}"),a=await r.del(`/api/users?action=delete&id=${e}&userId=${t.id}`);a&&a.success?(s("Success","User deleted successfully"),R()):i("Failed to Delete User",a?.error||"Unable to delete user")}catch(t){console.error("Failed to delete user:",t),i("Error","Failed to delete user. Please try again.")}})(A._id||A.id,A.email),I(null))},onCancel:()=>I(null)})]})});
/**
       * @license lucide-react v0.553.0 - ISC
       *
       * This source code is licensed under the ISC license.
       * See the LICENSE file in the root directory of this source tree.
       */
const t=s("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]),g=s("phone-call",[["path",{d:"M13 2a9 9 0 0 1 9 9",key:"1itnx2"}],["path",{d:"M13 6a5 5 0 0 1 5 5",key:"11nki7"}],["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]),x=s("qr-code",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]),u=s("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]),y=s("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]),f=s("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),b=s("wifi-off",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),w=s("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);function N(){const[e,t]=m.useState(null),[s,h]=m.useState(null),[g,y]=m.useState(!1),[f,N]=m.useState(null),[v,k]=m.useState(!1),[S,C]=m.useState(null),{showSuccess:A,showError:I,showInfo:M}=a(),D="https://academics-5bf1.onrender.com",R="whatsapp_status_cache_v1",L=m.useRef(null),j=m.useRef(15e3);m.useEffect(()=>{try{const e=localStorage.getItem(R);if(e){const s=JSON.parse(e);s?.status&&t(s.status),s?.connectionStatus&&h(s.connectionStatus),E(),U()}else E(),U()}catch(e){E(),U()}return L.current&&clearInterval(L.current),L.current=setInterval(U,j.current),()=>{L.current&&clearInterval(L.current)}},[]);const E=async()=>{try{const a=await r.get("/api/whatsapp-dispatch?action=status",{cache:!0,ttl:3e4,timeout:15e3});if(!a)return;console.log("WhatsApp status data:",a),t(a);try{const e=localStorage.getItem(R),t=e?JSON.parse(e):{};localStorage.setItem(R,JSON.stringify({status:a,connectionStatus:t.connectionStatus||s||null,ts:Date.now()}))}catch(e){}}catch(a){console.warn("Failed to fetch WhatsApp status:",a.message||a)}},U=async()=>{try{const s=await r.get("/api/whatsapp-dispatch?action=connection-status",{cache:!0,ttl:15e3,timeout:6e4,retry:1,retryDelay:800});if(!s)return;console.log("Connection status data:",s),h(s);try{const t=localStorage.getItem(R),a=t?JSON.parse(t):{};localStorage.setItem(R,JSON.stringify({status:a.status||e||null,connectionStatus:s,ts:Date.now()}))}catch(t){}}catch(s){h({connected:!1,state:"error",error:s?.message||"Network error"});try{15e3===j.current&&(j.current=3e4,L.current&&clearInterval(L.current),L.current=setInterval(U,j.current))}catch(t){}try{const t=localStorage.getItem(R),a=t?JSON.parse(t):{};localStorage.setItem(R,JSON.stringify({status:a.status||e||null,connectionStatus:{connected:!1,state:"error",error:s?.message||"Network error"},ts:Date.now()}))}catch(t){}}},W=async()=>{y(!0);try{console.log("Logging out instance...");const e=await r.post(`${D}/api/whatsapp-dispatch?action=logout`,null,{timeout:1e4});console.log("Logout response:",e),e&&e.success?(A("Disconnected",e.message||'WhatsApp disconnected successfully. Use "Get QR Code" to connect a different number.'),setTimeout(async()=>{await E(),await U()},1e3)):I("Failed to disconnect",e&&(e.error||e.message)||"Unknown error")}catch(e){console.error("Logout error:",e),I("Failed to disconnect WhatsApp",e.message||"Unknown error")}finally{y(!1)}},_=async()=>{console.log("ðŸ—‘ï¸ performDeleteInstance called!"),y(!0);try{console.log("ðŸ—‘ï¸ Starting instance deletion...");try{const e=await r.del(`${D}/api/whatsapp-dispatch?action=delete-instance`,{timeout:15e3});console.log("Delete instance result:",e),A("Instance Deleted",e.message||"WhatsApp instance has been deleted successfully"),t(e=>({...e,configured:!1})),h(null),console.log("â³ Waiting for backend cleanup..."),setTimeout(async()=>{console.log("ðŸ”„ Refreshing status..."),await E(),await U()},2e3)}catch(e){if(e&&404===e.status){const s=e.data||{};A("Instance Deleted",s.message||"WhatsApp instance has been deleted successfully"),t(e=>({...e,configured:!1})),h(null),setTimeout(async()=>{await E(),await U()},2e3)}else console.error("âŒ Delete instance error:",e),I("Failed to delete instance",e&&(e.message||e.data&&e.data.error)||"Check console for details")}}catch(s){console.error("âŒ Delete instance error:",s),I("Failed to delete instance",s.message||"Check console for details")}finally{y(!1)}};if(g&&!e)return l("div",{className:"bg-white rounded-lg shadow-sm p-6 border border-gray-200",children:n("div",{className:"animate-pulse",children:[l("div",{className:"h-4 bg-gray-200 rounded w-1/4 mb-4"}),l("div",{className:"h-20 bg-gray-200 rounded"})]})});if(!e)return null;const P=e.configured,O=!0===s?.connected||"open"===s?.state||!1,T=s?.state||"unknown";return n(o,{children:[n("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[l("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 px-6 py-4 border-b border-gray-200",children:n("div",{className:"flex items-center justify-between",children:[n("div",{className:"flex items-center gap-3",children:[l("div",{className:"w-3 h-3 rounded-full "+(O?"bg-green-500 animate-pulse":"bg-gray-400")}),l("h3",{className:"text-lg font-semibold text-gray-900",children:"Evolution API Status"})]}),l("button",{onClick:()=>{E(),U()},disabled:g,className:"p-2 hover:bg-white/50 rounded-lg transition-colors disabled:opacity-50",title:"Refresh status",children:l(u,{className:"w-4 h-4 text-gray-600 "+(g?"animate-spin":"")})})]})}),l("div",{className:"px-6 py-4 bg-gray-50 border-b border-gray-200",children:n("div",{className:"flex items-center justify-between",children:[n("div",{className:"flex items-center gap-3",children:[O?l(w,{className:"w-5 h-5 text-green-600"}):l(b,{className:"w-5 h-5 text-gray-400"}),n("div",{className:"flex-1",children:[l("p",{className:"text-sm font-medium text-gray-900",children:"Connection Status"}),n("p",{className:"text-xs text-gray-600",children:[l("span",O?{className:"text-green-600 font-semibold",children:"â— Connected"}:{className:"text-gray-500",children:"â— Disconnected"}),T&&"unknown"!==T&&n("span",{className:"ml-2 text-gray-500",children:["(",T,")"]})]}),!O&&s?.error&&n("p",{className:"text-xs text-red-500 mt-1",children:["Error: ",s.error]}),!O&&"not_configured"===s?.state&&l("p",{className:"text-xs text-yellow-600 mt-1",children:"âš ï¸ Evolution API not configured in .env"}),!O&&s?.error?.includes("404")&&l("p",{className:"text-xs text-yellow-600 mt-1",children:'âš ï¸ Instance not found - Click "Get QR Code" to create it'})]})]}),n("div",{className:"text-right",children:[l("p",{className:"text-xs text-gray-500",children:"Auto-refresh: 10s"}),s&&n("p",{className:"text-xs text-gray-400",children:["Last updated: ",(new Date).toLocaleTimeString()]})]})]})}),n("div",{className:"p-6 space-y-4",children:[n("div",{className:"flex items-start gap-3 p-4 bg-gray-50 rounded-lg",children:[P?l(i,{className:"w-5 h-5 text-green-600 flex-shrink-0 mt-0.5"}):l(c,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),n("div",{className:"flex-1",children:[n("div",{className:"flex items-center gap-2 mb-1",children:[l("span",{className:"font-medium text-gray-900",children:"Provider:"}),l("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:"Evolution API"})]}),l("p",{className:"text-sm text-gray-600",children:P?"âœ… Evolution API is configured and ready":"âŒ Evolution API is not configured"})]})]}),n("div",{className:"space-y-3",children:[void 0!==e.configured&&n("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[n("div",{className:"p-3 bg-blue-50 rounded-lg",children:[l("p",{className:"text-xs text-gray-600 mb-1",children:"Instance Name"}),l("p",{className:"text-sm font-medium text-gray-900",children:e.instance||"Not set"})]}),n("div",{className:"p-3 bg-blue-50 rounded-lg",children:[l("p",{className:"text-xs text-gray-600 mb-1",children:"Base URL"}),l("p",{className:"text-sm font-medium text-gray-900 truncate",children:e.baseUrl||"Not set"})]})]}),P&&n("div",{className:"space-y-2 pt-2",children:[n("div",{className:"flex gap-2",children:[n("button",{onClick:async()=>{y(!0);try{const e=await r.get("/api/whatsapp-dispatch?action=qrcode",{cache:!1,timeout:2e4});if(console.log("QR Code API response:",e),e.success){if(e.connected||"open"===e.state)return M("Already Connected",e.message||'WhatsApp instance is already connected. Use "Disconnect" to link a different number.'),void(await U());e.qrcode?(console.log("QR Code data:",e.qrcode),N(e.qrcode||e),k(!0),A("QR Code ready","Scan the QR code with your WhatsApp app.")):I("No QR Code","No QR code was returned. The instance may need to be created first.")}else I("Failed to generate QR code",e.error||"Unknown error")}catch(e){I("Failed to generate QR code",e.message||"Unknown error")}finally{y(!1)}},disabled:g,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[l(x,{className:"w-4 h-4"}),l("span",{children:"Get QR Code"})]}),n("button",{onClick:async()=>{y(!0),await E(),await U(),y(!1)},disabled:g,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[l(u,{className:"w-4 h-4 "+(g?"animate-spin":"")}),l("span",{children:"Refresh Status"})]})]}),n("button",{onClick:()=>{C({title:"Disconnect WhatsApp",message:"Disconnect the current WhatsApp number? You will need to scan a new QR code to reconnect.",onConfirm:W})},disabled:g,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Disconnect current WhatsApp and connect a new number",children:[l("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),l("span",{children:"Disconnect & Change Number"})]}),n("button",{onClick:()=>{console.log("ðŸ—‘ï¸ handleDeleteInstance clicked!"),C({title:"Delete WhatsApp Instance",message:"This will delete the instance and all session data. You will need to create a new instance and scan a fresh QR code. Continue?",onConfirm:_})},disabled:g,className:"w-full flex items-center justify-center gap-2 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete instance and all session data - fresh start",children:[l("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),l("span",{children:"Delete Instance"})]})]})]}),!P&&n("div",{className:"flex items-start gap-2 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:[l(d,{className:"w-5 h-5 text-yellow-600 flex-shrink-0 mt-0.5"}),n("div",{className:"flex-1",children:[l("p",{className:"text-sm text-yellow-800 mb-1",children:"WhatsApp service is not configured. Please set up Evolution API to enable marksheet dispatch."}),l("a",{href:e.setupGuide||"#",className:"text-sm font-medium text-yellow-900 hover:text-yellow-700 underline",target:"_blank",rel:"noopener noreferrer",children:"View Setup Guide â†’"})]})]})]}),v&&f&&l("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center min-h-screen p-3 sm:p-4",children:n("div",{className:"bg-white rounded-lg sm:rounded-xl shadow-2xl w-full max-w-sm sm:max-w-md p-4 sm:p-6 max-h-[90vh] overflow-y-auto",children:[n("div",{className:"flex items-center justify-between mb-4",children:[l("h3",{className:"text-base sm:text-lg font-semibold text-gray-900",children:"Scan QR Code"}),l("button",{onClick:()=>k(!1),className:"p-2 hover:bg-gray-100 rounded-lg transition-colors flex-shrink-0",children:l("svg",{className:"w-4 h-4 sm:w-5 sm:h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:l("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),l("div",{className:"bg-white p-3 sm:p-4 rounded-lg border-2 border-gray-200 flex justify-center",children:f.base64?l("img",{src:f.base64&&f.base64.startsWith("data:image")?f.base64:`data:image/png;base64,${f.base64}`,alt:"WhatsApp QR Code",className:"w-full max-w-xs sm:max-w-sm h-auto"}):f.qrcode?l("div",{className:"bg-gray-100 p-2 sm:p-4 rounded text-center overflow-x-auto",children:l("pre",{className:"text-xs overflow-auto whitespace-pre-wrap break-words",children:f.qrcode})}):l("p",{className:"text-center text-gray-500 text-sm",children:"QR code not available"})}),n("div",{className:"mt-4 p-3 sm:p-4 bg-blue-50 rounded-lg",children:[l("p",{className:"text-xs sm:text-sm text-gray-700 mb-2 font-semibold",children:"Steps to connect:"}),n("ol",{className:"text-xs sm:text-sm text-gray-600 space-y-1 list-decimal list-inside",children:[l("li",{children:"Open WhatsApp on your phone"}),l("li",{children:"Go to Settings â†’ Linked Devices"}),l("li",{children:'Tap "Link a Device"'}),l("li",{children:"Scan this QR code"})]})]}),l("button",{onClick:()=>k(!1),className:"mt-4 w-full px-4 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors text-sm sm:text-base",children:"Close"})]})})]}),S&&l(p,{open:!0,title:S.title,description:S.message,confirmLabel:"Delete",cancelLabel:"Cancel",onConfirm:()=>{console.log("âœ… Confirm dialog confirmed, executing callback..."),S.onConfirm(),C(null)},onCancel:()=>{console.log("âŒ Confirm dialog cancelled"),C(null)}})]})}function v(){const{showSuccess:e,showError:t,showInfo:s}=a(),[r,o]=m.useState(!1);async function i(){if("serviceWorker"in navigator){o(!0);try{const t=await navigator.serviceWorker.getRegistrations();await Promise.all(t.map(e=>e.unregister().catch(()=>!1))),e("Service Workers","All service workers unregistered"),g()}catch(s){t("Service Workers",String(s))}finally{o(!1)}}else t("Service Worker","Service workers are not supported in this browser")}async function c(){if("caches"in window){o(!0);try{const t=await caches.keys();await Promise.all(t.map(e=>caches.delete(e).catch(()=>!1))),e("Caches","All Cache Storage entries removed"),g()}catch(s){t("Caches",String(s))}finally{o(!1)}}else t("Cache","CacheStorage not supported")}function d(){try{localStorage.removeItem("whatsapp_status_cache_v1"),localStorage.removeItem("auth"),localStorage.removeItem("userEmail"),e("Local Storage","Selected localStorage keys cleared");try{localStorage.setItem("msec:reload_signal",Date.now())}catch(s){}g()}catch(s){t("Local Storage",String(s))}}function h(){try{s("Reload","Performing hard reload of this page"),window.location.reload(!0),g()}catch(e){t("Reload",String(e))}}async function g(){try{if(!("serviceWorker"in navigator))return;const t=await navigator.serviceWorker.getRegistrations();for(const s of t)try{const e=s.active||s.waiting||s.installing;e&&e.postMessage&&e.postMessage({type:"FORCE_RELOAD"})}catch(e){}}catch(e){}}const[x,u]=m.useState(null);return n("div",{className:"mt-4 bg-white p-3 rounded-md border border-gray-200",children:[l("h4",{className:"text-sm font-semibold text-gray-800 mb-2",children:"Service Worker & Cache Controls"}),l("p",{className:"text-xs text-gray-600 mb-3",children:"Use these controls when deploying to production to ensure clients pick up the latest assets."}),n("div",{className:"flex flex-wrap gap-2",children:[l("button",{onClick:()=>u({title:"Unregister service workers?",message:"This will unregister all service workers for this origin. Clients may lose offline support until you re-register the worker.",onConfirm:i}),disabled:r,className:"px-3 py-1 text-xs bg-red-600 text-white rounded-md",children:"Unregister SWs"}),l("button",{onClick:()=>u({title:"Clear CacheStorage?",message:"This will delete all CacheStorage entries for this origin. Offline assets and cached responses will be removed.",onConfirm:c}),disabled:r,className:"px-3 py-1 text-xs bg-orange-600 text-white rounded-md",children:"Clear CacheStorage"}),l("button",{onClick:()=>u({title:"Clear localStorage keys?",message:"This will clear selected application localStorage keys (auth, cached status). You will be logged out if auth is removed.",onConfirm:d}),className:"px-3 py-1 text-xs bg-yellow-600 text-white rounded-md",children:"Clear localStorage"}),l("button",{onClick:()=>u({title:"Hard reload page?",message:"This will force a full reload of this page. Unsaved state may be lost.",onConfirm:h}),className:"px-3 py-1 text-xs bg-gray-600 text-white rounded-md",children:"Hard Reload"})]}),x&&l(p,{open:!0,title:x.title,description:x.message,confirmLabel:"Proceed",cancelLabel:"Cancel",onConfirm:()=>{x.onConfirm(),u(null)},onCancel:()=>u(null)})]})}}}});
