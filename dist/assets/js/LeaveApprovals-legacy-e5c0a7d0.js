System.register(["./index-legacy-b6735175.js","./react-vendor-legacy-4587369d.js","./usePullToRefresh-legacy-6e4f4bfc.js"],function(e,t){"use strict";var s,r,a,o,n,i,d,l;return{setters:[e=>{s=e.j,r=e.u,a=e.b,o=e.a,n=e._},e=>{i=e.N,d=e.r},e=>{l=e.u}],execute:function(){e("default",function(){const e=localStorage.getItem("auth"),c=e?JSON.parse(e):null;if(!c||"hod"!==c.role)return s(i,{to:"/home",replace:!0});const{showSuccess:p,showError:u}=r(),[h,v]=d.useState([]),[m,g]=d.useState(!1),[f,w]=d.useState(null),x=async()=>{try{g(!0);const e=new URLSearchParams({department:c.department,type:"leave",status:"requested"});console.log("[LeaveApprovals] Fetching with:",{department:c.department,type:"leave",status:"requested"});const t=await o.get(`/api/leaves?${e.toString()}`);return console.log("[LeaveApprovals] Response:",t),t.success?(v(t.requests||[]),w({filter:t.filter,count:t.requests?.length||0,hodDept:c.department}),t):(u("Failed to load",t.error||"Could not fetch requests"),t)}catch(e){console.error("[LeaveApprovals] Error:",e),u("Error",e.message)}finally{g(!1)}};d.useEffect(()=>{x()},[]),l(x),d.useEffect(()=>{const e=()=>x();return window.addEventListener("notificationsUpdated",e),window.addEventListener("marksheetsUpdated",e),()=>{window.removeEventListener("notificationsUpdated",e),window.removeEventListener("marksheetsUpdated",e)}},[]);const y=async(e,s)=>{try{const i="approve"===s?{timeout:12e4}:{},d=await o.patch(`/api/leaves?id=${e}&action=${s}`,{hodId:c.id},Object.assign({},i,{dispatch:!1}));if(d&&d.success){if("approve"===s&&d.whatsappResult){const e=d.whatsappResult;e.sentPdf?p("Approved & Sent","Leave letter PDF sent via WhatsApp"):e.sentText?(p("Approved (text sent)","Approval text sent but PDF failed to send"),e.errors&&e.errors.length&&u("PDF send failed",e.errors[0])):(p("Approved","Request approved"),e.errors&&e.errors.length&&u("WhatsApp failed",e.errors[0]))}else p("approve"===s?"Approved":"Rejected","Request updated");try{n(()=>t.import("./notificationEvents-legacy-ed9f7877.js"),void 0).then(e=>e.notifyNotificationsUpdated())}catch(r){try{window.dispatchEvent(new Event("notificationsUpdated"))}catch(a){}}try{window.refreshNotificationCount&&window.refreshNotificationCount()}catch(r){}x()}else u("Failed",d?.error||"Could not update request")}catch(i){if(i&&("AbortError"===i.name||String(i).includes("signal is aborted")||String(i).includes("timeout")))try{const t=await x();t&&t.requests&&t.requests.find(t=>t._id===e)?u("Timeout","Server took too long to respond. The approval may not have completed — check request status."):p("Approved","Request approved (server-side) — refreshed list updated")}catch(d){u("Timeout","Server took too long to respond. The approval may have completed — check request status.")}else u("Error",i.message)}};return a("div",{className:"px-4 py-4 w-full max-w-4xl mx-auto",children:[a("div",{className:"flex items-center justify-between mb-4",children:[s("h1",{className:"text-2xl font-bold",children:"Leave Approvals"}),s("button",{onClick:x,className:"px-3 py-2 text-sm rounded-lg border bg-white hover:bg-gray-50",disabled:m,children:m?"Loading...":"Refresh"})]}),f&&a("div",{className:"mb-4 p-3 bg-blue-50 rounded-lg text-xs",children:[a("div",{children:["HOD Dept: ",f.hodDept]}),a("div",{children:["Found: ",f.count," requests"]})]}),m?s("div",{className:"p-4 text-gray-500",children:"Loading..."}):a("ul",{className:"divide-y bg-white rounded-xl shadow",children:[h.map(e=>a("li",{className:"p-4 flex items-center justify-between",children:[a("div",{children:[a("div",{className:"font-medium",children:[e.studentDetails?.name," (",e.studentDetails?.regNumber,")"]}),a("div",{className:"text-sm text-gray-600",children:[new Date(e.startDate).toLocaleDateString()," → ",new Date(e.endDate).toLocaleDateString()]}),a("div",{className:"text-sm text-gray-600",children:["Reason: ",e.reason]})]}),a("div",{className:"flex gap-2",children:[s("button",{onClick:()=>y(e._id,"approve"),className:"px-3 py-2 text-sm rounded-lg bg-green-600 text-white",children:"Approve"}),s("button",{onClick:()=>y(e._id,"reject"),className:"px-3 py-2 text-sm rounded-lg bg-red-600 text-white",children:"Reject"})]})]},e._id)),0===h.length&&s("li",{className:"p-4 text-gray-500",children:"No pending requests."})]})]})})}}});
