System.register(["./index-legacy-539dcb9c.js","./react-vendor-legacy-4587369d.js","./resultUtils-legacy-0d7791a3.js"],function(e,t){"use strict";var a,r,s,n,l,d,i,o,c,u,m;return{setters:[e=>{a=e.j,r=e.b,s=e.F,n=e.u,l=e.a,d=e.g},e=>{i=e.f,o=e.u,c=e.r},e=>{u=e.d,m=e.a}],execute:function(){function t({marksheet:e,onVerified:t}){const[i,o]=c.useState(!1),[u,m]=c.useState(""),[h,g]=c.useState(!1),[p]=c.useState(()=>{try{const e=localStorage.getItem("auth");return e?JSON.parse(e):null}catch{return null}});c.useEffect(()=>{g("verified_by_staff"===e?.status||"approved_by_hod"===e?.status||"dispatched"===e?.status)},[e]);const b=["approved_by_hod","rejected_by_hod","dispatched"],{showError:f}=n();return r(s,{children:[a("button",{disabled:i||h||b.includes(e?.status),onClick:async()=>{let a=p;try{const e=localStorage.getItem("auth");e&&(a=JSON.parse(e))}catch(r){console.error("Error refreshing user data:",r)}if(!a?.eSignature){const e=a?._id||a?.id||localStorage.getItem("userId");if(e)try{const t=await l.get(`/api/users?action=profile&userId=${e}`);t?.success&&t.user&&(a={...a,...t.user},localStorage.setItem("auth",JSON.stringify(a)))}catch(s){console.error("Error fetching user profile:",s)}}o(!0),m("");try{const s=a?.eSignature||null;if(!s){try{f("Signature Missing","Please add your signature in Settings before verifying this marksheet")}catch(r){}return void o(!1)}try{const a=await l.post("/api/marksheets?action=verify",s?{marksheetId:e._id,staffSignature:s}:{marksheetId:e._id});a&&a.success?(g(!0),t(a.marksheet)):m(a?.error||"Verification failed")}catch(r){m(d(r,"Verification failed"))}}catch(r){m(d(r,"Unexpected error"))}finally{o(!1)}},className:"px-5 py-2 rounded-lg transform transition-all duration-200 hover:-translate-y-0.5 hover:shadow-md w-full sm:w-auto "+(h||b.includes(e?.status)?"bg-green-200 text-green-900 cursor-not-allowed":i?"bg-green-200 text-green-900":"bg-green-600 text-white"),children:h?"Verified":i?"Verifying...":"Verify"}),u&&a("span",{className:"text-red-600 text-sm ml-2",children:u})]})}function h({id:e,form:t,onSaved:n}){const[i,o]=c.useState(!1),[u,m]=c.useState("");return r(s,{children:[a("button",{disabled:i,onClick:async()=>{o(!0),m("");try{try{const a=await l.put("/api/marksheets",{marksheetId:e,studentDetails:t.studentDetails,subjects:t.subjects,regenerateSignatures:!0});a&&a.success?n(a.marksheet):m(a?.error||"Save failed")}catch(a){m(d(a,"Save failed"))}}catch(a){m(d(a,"Unexpected error"))}finally{o(!1)}},className:"px-5 py-2 rounded-lg transform transition-all duration-200 hover:-translate-y-0.5 hover:shadow-md w-full sm:w-auto "+(i?"bg-blue-200 text-blue-900":"bg-blue-600 text-white"),children:i?"Saving...":"Save Changes"}),u&&a("span",{className:"text-red-600 text-sm ml-2",children:u})]})}function g({id:e,onRefreshed:t}){const[r,s]=c.useState(!1),{showSuccess:i,showError:o}=n();return a("button",{onClick:async()=>{s(!0);try{try{const a=await l.put("/api/marksheets",{marksheetId:e,regenerateSignatures:!0});a&&a.success?(i("Signatures Refreshed","Staff/HOD signatures were updated on this marksheet"),"function"==typeof t&&t(a.marksheet)):o("Refresh Failed",a?.error||"Could not refresh signatures")}catch(a){o("Refresh Failed",d(a,"Could not refresh signatures"))}}catch(a){o("Refresh Failed",d(a,"Unexpected error"))}finally{s(!1)}},disabled:r,className:"px-5 py-2 rounded-lg transform transition-all duration-200 hover:-translate-y-0.5 hover:shadow-md w-full sm:w-auto "+(r?"bg-gray-200 text-gray-800":"bg-indigo-600 text-white"),children:r?"Refreshing...":"Refresh Signatures"})}e("default",function(){const{id:e}=i(),n=o(),[p,b]=c.useState(null),[f,y]=c.useState(!0),[x,N]=c.useState(""),[v,w]=c.useState(!1),[k,S]=c.useState({studentDetails:{},subjects:[]}),[D]=c.useState(()=>{try{const e=localStorage.getItem("auth");return e?JSON.parse(e):null}catch{return null}});c.useEffect(()=>{(async()=>{if(!e||"undefined"===e||"null"===e)return N("Invalid marksheet id"),void y(!1);try{const t=await l.get(`/api/marksheets?marksheetId=${encodeURIComponent(e)}`);t&&t.success&&t.marksheet?(b(t.marksheet),t.marksheet&&S({studentDetails:{...t.marksheet.studentDetails||{}},subjects:Array.isArray(t.marksheet.subjects)?t.marksheet.subjects.map(e=>{const t=m(e);return{...e,result:"—"===t?"Pass":t}}):[]})):N(t?.error||"Failed to load marksheet")}catch(t){N(d(t,"Unexpected error"))}finally{y(!1)}})()},[e]);const _=c.useMemo(()=>{const e={draft:{label:"Draft",className:"bg-gray-100 text-gray-800"},verified_by_staff:{label:"Verified by Staff",className:"bg-green-100 text-green-800"},dispatch_requested:{label:"Dispatch Requested",className:"bg-yellow-100 text-yellow-800"},approved_by_hod:{label:"Approved by HOD",className:"bg-blue-100 text-blue-800"},rejected_by_hod:{label:"Rejected by HOD",className:"bg-red-100 text-red-800"},dispatched:{label:"Dispatched",className:"bg-purple-100 text-purple-800"},unknown:{label:"Unknown",className:"bg-gray-200 text-gray-700"}};return e["rescheduled_by_hod"===p?.status?"dispatch_requested":p?.status||"unknown"]||e.unknown},[p]),j=c.useMemo(()=>{if(!p||!D||"staff"!==D.role)return!1;const e=p.staffId?._id||p.staffId,t=D._id||D.id;if(!e||!t)return!1;try{return String(e)===String(t)}catch{return!1}},[p,D]),R=c.useMemo(()=>{if(!p||!D||"hod"!==D.role)return!1;const e=p.hodId?._id||p.hodId,t=D._id||D.id;if(!e||!t)return!1;try{return String(e)===String(t)}catch{return!1}},[p,D]),C="staff"===D?.role&&j,I=c.useMemo(()=>u(p),[p]);return a("div",f?{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 flex items-center justify-center",children:r("div",{className:"glass-card p-8 rounded-3xl text-center",children:[a("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),a("p",{className:"text-gray-600",children:"Loading marksheet..."})]})}:x||!p?{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 flex items-center justify-center",children:r("div",{className:"glass-card p-8 rounded-3xl text-center",children:[a("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Not Found"}),a("p",{className:"text-gray-600",children:x||"Marksheet not found"}),a("button",{onClick:()=>n(-1),className:"mt-6 px-5 py-2 bg-blue-600 text-white rounded-lg",children:"Go Back"})]})}:{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:a("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:r("div",{className:"max-w-4xl mx-auto",children:[r("div",{className:"text-center mb-12",children:[a("h1",{className:"text-4xl sm:text-5xl lg:text-6xl font-black text-gray-900 mb-4",children:"Marksheet Details"}),r("p",{className:"text-lg text-gray-600 max-w-3xl mx-auto",children:["View, verify, and manage individual student marksheet details.",a("br",{}),"Track pass/fail/absent outcomes, dispatch status, and update student information as needed."]})]}),r("div",{className:"glass-card p-8 rounded-3xl transform transition-all duration-200 hover:-translate-y-0.5 hover:shadow-md hover:border-gray-300",children:[r("div",{className:"flex items-center justify-between mb-6",children:[a("h2",{className:"text-3xl font-bold text-gray-900",children:p.studentDetails?.name}),a("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${_.className}`,children:_.label.toUpperCase()})]}),r("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[r("div",{className:"bg-white p-6 rounded-xl border border-gray-200 transform transition-all duration-200 hover:-translate-y-0.5 hover:shadow-md hover:border-gray-300",children:[a("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Student"}),v?r("div",{className:"space-y-3",children:[r("div",{children:[a("label",{className:"block text-sm text-gray-600 mb-1",children:"Name"}),a("input",{value:k.studentDetails.name||"",onChange:e=>S(t=>({...t,studentDetails:{...t.studentDetails,name:e.target.value}})),className:"w-full border rounded-lg px-3 py-2"})]}),r("div",{children:[a("label",{className:"block text-sm text-gray-600 mb-1",children:"Reg No"}),a("input",{value:k.studentDetails.regNumber||"",onChange:e=>S(t=>({...t,studentDetails:{...t.studentDetails,regNumber:e.target.value}})),className:"w-full border rounded-lg px-3 py-2"})]}),r("div",{className:"grid grid-cols-2 gap-3",children:[r("div",{children:[a("label",{className:"block text-sm text-gray-600 mb-1",children:"Year"}),a("input",{value:k.studentDetails.year||"",onChange:e=>S(t=>({...t,studentDetails:{...t.studentDetails,year:e.target.value}})),className:"w-full border rounded-lg px-3 py-2",placeholder:"e.g., II"})]}),r("div",{children:[a("label",{className:"block text-sm text-gray-600 mb-1",children:"Semester"}),a("input",{value:k.semester||k.studentDetails.semester||"",onChange:e=>S(t=>({...t,semester:e.target.value})),className:"w-full border rounded-lg px-3 py-2",placeholder:"e.g., 1"})]})]}),r("div",{children:[a("label",{className:"block text-sm text-gray-600 mb-1",children:"Department"}),a("input",{value:k.studentDetails.department||"",onChange:e=>S(t=>({...t,studentDetails:{...t.studentDetails,department:e.target.value}})),className:"w-full border rounded-lg px-3 py-2"})]}),r("div",{children:[a("label",{className:"block text-sm text-gray-600 mb-1",children:"Parent Phone"}),a("input",{value:k.studentDetails.parentPhoneNumber||"",onChange:e=>S(t=>({...t,studentDetails:{...t.studentDetails,parentPhoneNumber:e.target.value}})),className:"w-full border rounded-lg px-3 py-2"})]})]}):r(s,{children:[r("p",{className:"text-gray-700",children:[a("strong",{children:"Reg No:"})," ",p.studentDetails?.regNumber]}),r("p",{className:"text-gray-700",children:[a("strong",{children:"Year/Sem:"})," ",p.studentDetails?.year,"/",p.semester||p.studentDetails?.semester||"N/A"]}),r("p",{className:"text-gray-700",children:[a("strong",{children:"Department:"})," ",p.studentDetails?.department]}),r("p",{className:"text-gray-700",children:[a("strong",{children:"Parent:"})," ",p.studentDetails?.parentPhoneNumber]})]})]}),r("div",{className:"bg-white p-6 rounded-xl border border-gray-200 transform transition-all duration-200 hover:-translate-y-0.5 hover:shadow-md hover:border-gray-300",children:[a("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Summary"}),r("p",{className:"text-gray-700",children:[a("strong",{children:"Examination Name:"})," ",p.examinationName||"N/A"]}),r("p",{className:"text-gray-700",children:[a("strong",{children:"Examination Date:"})," ",p.examinationDate?new Date(p.examinationDate).toLocaleString("default",{month:"long",year:"numeric"}):"N/A"]}),r("p",{className:"text-gray-700",children:[a("strong",{children:"Overall Result:"})," ",I]}),r("p",{className:"text-gray-700",children:[a("strong",{children:"Staff:"})," ",p.staffName]}),p.hodName&&r("p",{className:"text-gray-700",children:[a("strong",{children:"HOD:"})," ",p.hodName]}),"approved_by_hod"===p.status&&p.dispatchRequest?.respondedAt&&r("p",{className:"text-gray-700",children:[a("strong",{children:"Approved On:"})," ",new Date(p.dispatchRequest.respondedAt).toLocaleString()]})]})]}),p.dispatchRequest?.hodResponse&&r("div",{className:"mt-6 bg-white p-6 rounded-xl border border-gray-200",children:[a("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Dispatch Notes"}),r("dl",{className:"space-y-2 text-gray-700",children:[p.dispatchRequest?.hodResponse&&r("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[a("dt",{className:"font-medium",children:"HOD Decision"}),a("dd",{className:"capitalize",children:p.dispatchRequest.hodResponse})]}),p.dispatchRequest?.hodComments&&r("div",{children:[a("dt",{className:"font-medium",children:"Comments"}),a("dd",{className:"text-gray-700 mt-1",children:p.dispatchRequest.hodComments})]})]})]}),r("div",{className:"mt-8 bg-white p-6 rounded-xl border border-gray-200 transform transition-all duration-200 hover:-translate-y-0.5 hover:shadow-md hover:border-gray-300",children:[a("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Subjects"}),a("div",v?{className:"space-y-3",children:k.subjects.map((e,t)=>r("div",{className:"grid grid-cols-3 gap-3 items-center",children:[a("input",{value:e.subjectName,onChange:e=>S(a=>{const r=[...a.subjects];return r[t]={...r[t],subjectName:e.target.value},{...a,subjects:r}}),className:"border rounded-lg px-3 py-2"}),a("input",{type:"number",value:e.marks,onChange:e=>S(a=>{const r=[...a.subjects];return r[t]={...r[t],marks:Number(e.target.value)},{...a,subjects:r}}),className:"border rounded-lg px-3 py-2"}),r("select",{value:e.result||"",onChange:e=>S(a=>{const r=[...a.subjects];return r[t]={...r[t],result:e.target.value},{...a,subjects:r}}),className:"border rounded-lg px-3 py-2",children:[a("option",{value:"",children:"Select Result"}),a("option",{value:"Pass",children:"Pass"}),a("option",{value:"Fail",children:"Fail"}),a("option",{value:"Absent",children:"Absent"})]})]},t))}:{className:"divide-y divide-gray-100",children:(p.subjects||[]).map((e,t)=>r("div",{className:"py-3 space-y-1 sm:space-y-0 sm:grid sm:grid-cols-2 sm:items-center",children:[a("span",{className:"text-gray-800 break-words min-w-0",children:e.subjectName}),r("div",{className:"flex items-center justify-between sm:justify-end gap-2 text-gray-700",children:[a("span",{className:"font-semibold",children:e.marks??"—"}),r("span",{className:"whitespace-nowrap",children:["Result: ",m(e)]})]})]},t))})]}),r("div",{className:"mt-8 flex flex-col sm:flex-row gap-3",children:[a("button",{onClick:()=>n(-1),className:"px-5 py-2 bg-gray-100 text-gray-800 rounded-lg transform transition-all duration-200 hover:-translate-y-0.5 hover:shadow-md w-full sm:w-auto",children:"Back"}),!v&&C&&r(s,{children:[a(t,{marksheet:p,onVerified:b}),a("button",{onClick:()=>w(!0),className:"px-5 py-2 bg-blue-600 text-white rounded-lg transform transition-all duration-200 hover:-translate-y-0.5 hover:shadow-md w-full sm:w-auto",children:"Edit & Regenerate"})]}),!v&&(C||R)&&r("div",{className:"flex gap-2 w-full sm:w-auto",children:[a(g,{id:p._id,onRefreshed:b}),a("button",{onClick:e=>{e.preventDefault();const t=Date.now(),a=window.location.origin,r=a?`${a}/api/generate-pdf?marksheetId=${p._id}&t=${t}`:`/api/generate-pdf?marksheetId=${p._id}&t=${t}`;window.open(r,"_blank")},className:"px-5 py-2 rounded-lg transform transition-all duration-200 hover:-translate-y-0.5 hover:shadow-md w-full sm:w-auto bg-yellow-600 text-white",children:"Download PDF"})]}),v&&C&&r(s,{children:[a("button",{onClick:()=>w(!1),className:"px-5 py-2 bg-gray-200 text-gray-800 rounded-lg transform transition-all duration-200 hover:-translate-y-0.5 hover:shadow-md w-full sm:w-auto",children:"Cancel"}),a(h,{id:p._id,form:k,onSaved:e=>{b(e),w(!1)}})]})]})]})]})})})})}}});
