import{j as t,b as r,a as x}from"./index-a36099b1.js";import{r as c}from"./react-vendor-ad4d5528.js";function C(){const[l,y]=c.useState(()=>{const e=localStorage.getItem("auth");return e?JSON.parse(e):null}),[n,h]=c.useState(null),[i,d]=c.useState(!1),[o,g]=c.useState(""),[p,u]=c.useState(null),[m,a]=c.useState([]),b=e=>{e.target.files&&e.target.files[0]&&h(e.target.files[0])},f=async()=>{if(n){d(!0),a([]),u(null);try{const e=new FormData;e.append("excelFile",n),e.append("staffId",l.id),e.append("examinationDate",new Date().toISOString()),e.append("department",l.department),e.append("year",l.year);try{const s=await x.post("/api/import-excel?action=upload",e);!s||!s.success?a([(s==null?void 0:s.error)||"Upload failed"]):(g(s.sessionId),a(s.errorMessages||[]))}catch(s){a([s.message||"Unexpected error"])}}catch(e){a([e.message||"Unexpected error"])}finally{d(!1)}}},N=async()=>{if(o){d(!0);try{try{const e=await x.post("/api/import-excel?action=confirm",{sessionId:o});!e||!e.success?a([(e==null?void 0:e.error)||"Confirm failed"]):u(e)}catch(e){a([e.message||"Unexpected error"])}}catch(e){a([e.message||"Unexpected error"])}finally{d(!1)}}};return!l||l.role!=="staff"?t("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 flex items-center justify-center",children:r("div",{className:"glass-card p-8 rounded-3xl text-center",children:[t("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Access Denied"}),t("p",{className:"text-gray-600",children:"Only staff members can import marks."})]})}):t("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:t("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:r("div",{className:"max-w-4xl mx-auto",children:[r("div",{className:"text-center mb-8",children:[t("h1",{className:"text-4xl sm:text-5xl lg:text-6xl font-black text-gray-900 mb-4",children:"Import Student Marks"}),r("p",{className:"text-lg text-gray-600 max-w-3xl mx-auto",children:["Upload Excel file with student marks data for ",l.department," Department - Year ",l.year]})]}),r("div",{className:"glass-card p-8 rounded-3xl mb-8",children:[r("div",{className:"border-2 border-dashed border-gray-300 rounded-xl p-12 text-center",children:[t("svg",{className:"w-16 h-16 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),t("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Drop Excel file here"}),t("p",{className:"text-gray-600 mb-6",children:"or click to browse"}),t("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:b,className:"hidden",id:"excelFile"}),t("label",{htmlFor:"excelFile",className:"glass-button px-6 py-3 text-blue-600 rounded-xl font-bold cursor-pointer inline-block",children:n?"Change File":"Choose File"}),n&&r("div",{className:"mt-4 text-gray-700",children:["Selected: ",t("span",{className:"font-semibold",children:n.name})]}),t("div",{className:"mt-6",children:t("button",{disabled:!n||i,onClick:f,className:"px-6 py-3 rounded-xl font-bold ".concat(!n||i?"bg-gray-300 text-gray-500":"glass-button text-blue-600"),children:i?"Uploading...":"Upload"})})]}),o&&r("div",{className:"mt-6 p-4 bg-green-50 rounded-xl text-green-800",children:["Temporary session created. Session ID: ",t("span",{className:"font-mono",children:o}),t("div",{className:"mt-3",children:t("button",{onClick:N,disabled:i,className:"px-5 py-2 rounded-lg font-semibold ".concat(i?"bg-gray-300 text-gray-500":"bg-green-600 text-white"),children:i?"Processing...":"Confirm Import"})})]}),m&&m.length>0&&r("div",{className:"mt-6 p-4 bg-red-50 rounded-xl text-red-800",children:[t("div",{className:"font-semibold mb-2",children:"Issues found:"}),t("ul",{className:"list-disc pl-6 space-y-1",children:m.map((e,s)=>t("li",{children:e},s))})]}),p&&r("div",{className:"mt-6 p-4 bg-blue-50 rounded-xl text-blue-900",children:[t("div",{className:"font-semibold mb-2",children:"Import Completed"}),r("div",{children:["Created: ",p.createdCount]})]}),r("div",{className:"mt-8 p-6 bg-blue-50 rounded-xl",children:[t("h4",{className:"text-lg font-semibold text-blue-900 mb-3",children:"Excel Format Requirements:"}),r("ul",{className:"text-blue-800 space-y-2",children:[r("li",{children:["• ",t("strong",{children:"Name"})," - Student full name"]}),r("li",{children:["• ",t("strong",{children:"RegNumber"})," - Student registration number"]}),r("li",{children:["• ",t("strong",{children:"Section"})," - Class section (A, B, etc.)"]}),r("li",{children:["• ",t("strong",{children:"ParentPhone"})," - Parent WhatsApp number"]}),r("li",{children:["• ",t("strong",{children:"Subject Columns"})," - Each subject with marks (0-100)"]})]})]})]})]})})})}export{C as default};
