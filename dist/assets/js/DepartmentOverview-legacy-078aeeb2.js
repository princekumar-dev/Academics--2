System.register(["./index-legacy-539dcb9c.js","./react-vendor-legacy-4587369d.js"],function(e,t){"use strict";var a,r,s,l,n;return{setters:[e=>{a=e.a,r=e.j,s=e.b},e=>{l=e.u,n=e.r}],execute:function(){e("default",function(){const e=l(),[t,d]=n.useState(()=>{const e=localStorage.getItem("auth");return e?JSON.parse(e):null}),[i,o]=n.useState(null),[c,m]=n.useState([]),[g,p]=n.useState([]),[h,x]=n.useState([]),[u,f]=n.useState(!0),b={CSE:"bg-blue-100 text-blue-800",AI_DS:"bg-indigo-100 text-indigo-800",ECE:"bg-teal-100 text-teal-800",IT:"bg-green-100 text-green-800",MECH:"bg-amber-100 text-amber-800",CIVIL:"bg-red-100 text-red-800",EEE:"bg-purple-100 text-purple-800",HNS:"bg-yellow-50 text-yellow-800"},v={CSE:{cardBg:"bg-gradient-to-br from-blue-50 to-blue-100",border:"border-blue-200",title:"text-blue-600",value:"text-blue-700",accent:"text-blue-400"},AI_DS:{cardBg:"bg-gradient-to-br from-indigo-50 to-indigo-100",border:"border-indigo-200",title:"text-indigo-600",value:"text-indigo-700",accent:"text-indigo-400"},ECE:{cardBg:"bg-gradient-to-br from-teal-50 to-teal-100",border:"border-teal-200",title:"text-teal-600",value:"text-teal-700",accent:"text-teal-400"},IT:{cardBg:"bg-gradient-to-br from-green-50 to-green-100",border:"border-green-200",title:"text-green-600",value:"text-green-700",accent:"text-green-400"},MECH:{cardBg:"bg-gradient-to-br from-amber-50 to-amber-100",border:"border-amber-200",title:"text-amber-700",value:"text-amber-800",accent:"text-amber-600"},CIVIL:{cardBg:"bg-gradient-to-br from-red-50 to-red-100",border:"border-red-200",title:"text-red-600",value:"text-red-700",accent:"text-red-400"},EEE:{cardBg:"bg-gradient-to-br from-purple-50 to-purple-100",border:"border-purple-200",title:"text-purple-600",value:"text-purple-700",accent:"text-purple-400"},HNS:{cardBg:"bg-gradient-to-br from-yellow-50 to-yellow-100",border:"border-yellow-200",title:"text-yellow-700",value:"text-yellow-800",accent:"text-yellow-600"}};n.useEffect(()=>{t&&"hod"===t.role&&N()},[t]);const N=async()=>{try{const e="HNS"===t.department?"/api/marksheets?year=I&includeAll=true":`/api/marksheets?department=${t.department}&includeAll=true`,[r,s]=await Promise.all([a.get(e),a.get("/api/users")]);if(r.success){const e=r.marksheets,t=s.success?s.users:[],a={};t.forEach(e=>{e.id&&(a[e.id]=e,a[e.id.toString()]=e),e._id&&(a[e._id]=e,a[e._id.toString()]=e)}),console.log("=== Department Overview Debug ==="),console.log("Total marksheets:",e.length),console.log("Total users fetched:",t.length),e.length>0&&console.log("Sample marksheet:",{staffId:e[0].staffId,staffName:e[0].staffName}),t.length>0&&console.log("All users:",t.map(e=>({id:e.id,name:e.name,role:e.role,year:e.year,section:e.section,department:e.department}))),console.log("UserMap keys:",Object.keys(a)),console.log("=== End Debug ===");const l=e.length,n=new Set(e.map(e=>e.studentDetails?.regNumber)).size,d={draft:e.filter(e=>"draft"===e.status).length,verified:e.filter(e=>"verified_by_staff"===e.status).length,pending:e.filter(e=>"dispatch_requested"===e.status).length,approved:e.filter(e=>"approved_by_hod"===e.status).length,rejected:e.filter(e=>"rejected_by_hod"===e.status).length,dispatched:e.filter(e=>"dispatched"===e.status).length},i=l>0?Math.round(d.dispatched/l*100):0,c={totalMarksheets:l,totalStudents:n,byClass:{},byStatus:d,completionRate:i,pendingActions:d.pending};e.forEach(e=>{const t=e.studentDetails?.year||"Unknown";c.byClass[t]||(c.byClass[t]=0),c.byClass[t]++});const g=e.sort((e,t)=>new Date(t.updatedAt)-new Date(e.updatedAt)).slice(0,10).map(e=>({id:e._id,student:e.studentDetails?.name||"Unknown",regNumber:e.studentDetails?.regNumber||"N/A",status:e.status,updatedAt:e.updatedAt,examination:e.examination?.name||"N/A"})),h={},u={};e.forEach(e=>{const t=(e.staffId||e.createdBy||e.userId||"Unknown").toString(),r=e.studentDetails?.department||"Unknown";if(u[r]||(u[r]={total:0,dispatched:0,pending:0,uniqueStudents:new Set,topStaff:{}}),u[r].total++,"dispatched"===e.status&&u[r].dispatched++,"dispatch_requested"===e.status&&u[r].pending++,e.studentDetails?.regNumber&&u[r].uniqueStudents.add(e.studentDetails.regNumber),!h[t]){const r=a[t],s=r?.name||e.staffName||"Unknown Staff",l=e.studentDetails?.year||null,n=e.studentDetails?.section||null;r||"Unknown"===t||(console.log("Staff not found for ID:",t),console.log("Using fallback staffName:",e.staffName)),h[t]={total:0,verified:0,dispatched:0,staffName:s,year:l,section:n}}if(u[r]){const a=u[r].topStaff[t]||{staffName:h[t]?.staffName||e.staffName||"Unknown",total:0,dispatched:0};a.total++,"dispatched"===e.status&&a.dispatched++,u[r].topStaff[t]=a}h[t].total++,"verified_by_staff"!==e.status&&"dispatch_requested"!==e.status&&"approved_by_hod"!==e.status&&"dispatched"!==e.status||h[t].verified++,"dispatched"===e.status&&h[t].dispatched++});const f=Object.entries(h).map(([t,r])=>{const s=r.year?.toString().trim()||null,l=r.section?.toString().trim()||null;let n="N/A";s&&l?n=`${s}-${l}`:s?n=s:l&&(n=l),0===Object.keys(h).indexOf(t)&&console.log("First staff stats:",{id:t,staffName:r.staffName,year:r.year,section:r.section,className:n});let d=null;if(void 0!==a&&a&&(d=a[t]?.department||a[t?.toString()]?.department||null,!d)){const e=Object.values(a).find(e=>e&&(String(e.id)===String(t)||String(e._id)===String(t)));d=e?.department||null}if(!d){const a=e.find(e=>{try{return String(e.staffId)===String(t)||String(e.staffId)===t}catch{return!1}});d=a?.studentDetails?.department||null}return{staffId:t,staffName:r.staffName,className:n,department:d,total:r.total,verified:r.verified,dispatched:r.dispatched,completionRate:r.total>0?Math.round(r.dispatched/r.total*100):0}}).sort((e,t)=>t.completionRate-e.completionRate),b=Object.entries(u).map(([e,t])=>{const a=Object.entries(t.topStaff||{}).map(([e,t])=>({staffId:e,staffName:t.staffName,total:t.total,dispatched:t.dispatched}));return a.sort((e,t)=>t.total-e.total),{department:e,totalMarksheets:t.total,students:t.uniqueStudents.size,dispatched:t.dispatched,pending:t.pending,completionRate:t.total>0?Math.round(t.dispatched/t.total*100):0,topStaff:a.slice(0,3)}}).sort((e,t)=>t.totalMarksheets-e.totalMarksheets);o(c),m(g),p(f),x(b)}}catch(e){console.error("Error fetching department data:",e)}finally{f(!1)}};return t&&"hod"===t.role?r("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 no-mobile-anim",children:r("div",{className:"responsive-container py-6 md:py-8",children:s("div",{className:"max-w-7xl mx-auto",children:[r("div",{className:"mb-6 md:mb-8",children:r("div",{className:"glass-card no-mobile-backdrop responsive-spacing rounded-3xl",children:s("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[s("div",{children:[r("h1",{className:"text-3xl sm:text-4xl lg:text-5xl font-black text-[#111418] mb-2",children:"Department Overview"}),s("p",{className:"text-base sm:text-lg text-gray-600",children:["Real-time overview for ",t.department," Department"]})]}),s("div",{className:"flex flex-wrap items-center gap-3",children:[s("div",{className:"glass-card px-3 py-2 rounded-xl",children:[r("div",{className:"text-xs text-gray-500",children:"Students"}),r("div",{className:"text-xl md:text-2xl font-bold text-theme-gold-600",children:i?.totalStudents||0})]}),s("div",{className:"glass-card px-3 py-2 rounded-xl",children:[r("div",{className:"text-xs text-gray-500",children:"Completion"}),s("div",{className:"text-xl md:text-2xl font-bold text-green-600",children:[i?.completionRate||0,"%"]})]}),s("div",{className:"glass-card px-3 py-2 rounded-xl",children:[r("div",{className:"text-xs text-gray-500",children:"Pending"}),r("div",{className:"text-xl md:text-2xl font-bold text-yellow-600",children:i?.pendingActions||0})]})]})]})})}),r("div",{className:"glass-card no-mobile-backdrop responsive-spacing rounded-3xl mb-6 md:mb-8",children:s("div",u?{className:"text-center py-12",children:[r("div",{className:"loading-spinner mx-auto mb-4"}),r("p",{className:"responsive-text text-gray-600",children:"Loading department data..."})]}:{className:"space-y-6 md:space-y-8",children:[s("div",{children:[s("div",{className:"flex items-center gap-2 mb-4",children:[r("svg",{className:"w-5 h-5 md:w-6 md:h-6 text-theme-gold-600 inline-flex",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:{marginTop:"-2px"},children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7h18M3 12h18M3 17h18"})}),r("h2",{className:"responsive-heading-2 text-gray-900",children:"Department-wise Distribution"})]}),r("div",{className:"responsive-grid responsive-grid-2 md:grid-cols-4",children:(h&&h.length>0?h:Object.entries(i?.byClass||{}).map(([e,t])=>({department:e,totalMarksheets:t}))).map(e=>{const t=v[e.department]||{cardBg:"bg-gradient-to-br from-slate-50 to-slate-100",border:"border-slate-200",title:"text-slate-600",value:"text-slate-700",accent:"text-slate-400"};return r("div",{className:`responsive-card ${t.cardBg} border-2 ${t.border} hover:shadow-lg transition-all duration-300`,children:s("div",{className:"flex items-center justify-between",children:[s("div",{children:[r("p",{className:`text-xs md:text-sm font-medium mb-1 ${t.title}`,children:e.department}),r("p",{className:`text-2xl md:text-3xl font-bold ${t.value}`,children:e.totalMarksheets??e.count??e.total??0})]}),r("div",{children:r("span",{className:`inline-flex items-center px-2 py-0.5 text-xs font-semibold rounded-full ${b[e.department]||"bg-gray-100 text-gray-800"}`,children:e.department})})]})},e.department)})})]}),s("div",{children:[s("div",{className:"flex items-center gap-2 mb-4",children:[r("svg",{className:"w-5 h-5 md:w-6 md:h-6 text-theme-gold-600 inline-flex",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:{marginTop:"-2px"},children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})}),r("h2",{className:"responsive-heading-2 text-gray-900",children:"Staff Performance"})]}),r("div",{className:"responsive-grid responsive-grid-2 lg:grid-cols-3",children:g.slice(0,6).map((e,t)=>s("div",{className:"responsive-card bg-gradient-to-br from-indigo-50 to-indigo-100 border-2 border-indigo-200",children:[s("div",{className:"flex items-center justify-between mb-3",children:[s("div",{className:"flex items-center gap-2",children:[r("div",{className:"w-8 h-8 bg-indigo-200 rounded-full flex items-center justify-center",children:s("span",{className:"text-sm font-bold text-indigo-700",children:["#",t+1]})}),s("div",{children:[s("div",{className:"flex items-center gap-2",children:[r("div",{className:"text-sm font-bold text-indigo-900",children:e.staffName}),e.department&&r("span",{className:`inline-flex items-center px-2 py-0.5 text-[11px] font-semibold rounded-full ${b[e.department]||"bg-gray-100 text-gray-800"} uppercase`,children:e.department})]}),r("div",{className:"text-xs text-indigo-600",children:e.className})]})]}),s("div",{className:"text-right",children:[s("div",{className:"text-2xl font-bold text-indigo-700",children:[e.completionRate,"%"]}),r("div",{className:"text-xs text-indigo-600",children:"Complete"})]})]}),s("div",{className:"grid grid-cols-3 gap-2 text-center",children:[s("div",{children:[r("div",{className:"text-lg font-bold text-indigo-900",children:e.total}),r("div",{className:"text-xs text-indigo-600",children:"Total"})]}),s("div",{children:[r("div",{className:"text-lg font-bold text-green-600",children:e.verified}),r("div",{className:"text-xs text-indigo-600",children:"Verified"})]}),s("div",{children:[r("div",{className:"text-lg font-bold text-purple-600",children:e.dispatched}),r("div",{className:"text-xs text-indigo-600",children:"Sent"})]})]})]},e.staffId))})]}),s("div",{children:[s("div",{className:"flex items-center gap-2 mb-4",children:[r("svg",{className:"w-5 h-5 md:w-6 md:h-6 text-theme-gold-600 inline-flex",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",style:{marginTop:"-2px"},children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),r("h2",{className:"responsive-heading-2 text-gray-900",children:"Quick Actions"})]}),s("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6",children:[s("button",{onClick:()=>e("/approval-requests"),className:"responsive-card group bg-gradient-to-br from-yellow-50 to-yellow-100 border-2 border-yellow-200 hover:shadow-xl transition-all duration-300 text-left",children:[s("div",{className:"flex items-start justify-between mb-3",children:[r("div",{className:"p-3 bg-yellow-100 rounded-xl group-hover:bg-yellow-200 transition-colors",children:r("svg",{className:"w-6 h-6 md:w-7 md:h-7 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),r("span",{className:"text-xs font-semibold text-yellow-600 bg-yellow-50 px-2 py-1 rounded-full",children:i?.byStatus.pending||0})]}),r("h3",{className:"text-base md:text-lg font-bold text-yellow-900 mb-2",children:"Pending Approvals"}),r("p",{className:"text-sm text-yellow-700",children:"Review dispatch requests awaiting approval"})]}),s("button",{onClick:()=>e("/reports"),className:"responsive-card group bg-gradient-to-br from-green-50 to-green-100 border-2 border-green-200 hover:shadow-xl transition-all duration-300 text-left",children:[s("div",{className:"flex items-start justify-between mb-3",children:[r("div",{className:"p-3 bg-green-100 rounded-xl group-hover:bg-green-200 transition-colors",children:r("svg",{className:"w-6 h-6 md:w-7 md:h-7 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),r("span",{className:"text-xs font-semibold text-green-600 bg-green-50 px-2 py-1 rounded-full",children:"Reports"})]}),r("h3",{className:"text-base md:text-lg font-bold text-green-900 mb-2",children:"Export Reports"}),r("p",{className:"text-sm text-green-700",children:"Generate comprehensive department analytics"})]}),s("button",{onClick:()=>{const a="HNS"===t?.department?"/records?year=I&includeAll=true":`/records?department=${encodeURIComponent(t?.department||"")}`;e(a)},className:"responsive-card group bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-blue-200 hover:shadow-xl transition-all duration-300 text-left",children:[s("div",{className:"flex items-start justify-between mb-3",children:[r("div",{className:"p-3 bg-blue-100 rounded-xl group-hover:bg-blue-200 transition-colors",children:r("svg",{className:"w-6 h-6 md:w-7 md:h-7 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),r("span",{className:"text-xs font-semibold text-blue-600 bg-blue-50 px-2 py-1 rounded-full",children:"All"})]}),r("h3",{className:"text-base md:text-lg font-bold text-blue-900 mb-2",children:"View All Records"}),r("p",{className:"text-sm text-blue-700",children:"Browse complete department marksheets"})]})]})]})]})})]})})}):r("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 flex items-center justify-center",children:s("div",{className:"glass-card p-8 rounded-3xl text-center",children:[r("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Access Denied"}),r("p",{className:"text-gray-600",children:"Only HODs can view department overview."})]})})})}}});
